(function(e,t){"function"==typeof define&&define.amd?define([],function(){return t(e.Countly)}):"object"==typeof module&&module.exports?module.exports=t(e.Countly):e.Countly=t(e.Countly)})("undefined"==typeof window?this:window,function(t){var i=Math.max,n=Math.floor;function a(e){var i=document.createElement("script"),n=document.createElement("script");i.async=!0,n.async=!0,i.src=t.customSourceBoomerang||G.BOOMERANG_SRC,n.src=t.customSourceCountlyBoomerang||G.CLY_BOOMERANG_SRC,document.getElementsByTagName("head")[0].appendChild(i),document.getElementsByTagName("head")[0].appendChild(n);var a=!1,r=!1;i.onload=function(){a=!0},n.onload=function(){r=!0};var o=0,s=50,d=1500,c=setInterval(function(){if(o+=s,a&&r||o>=d){if(t.debug){var i="BoomerangJS loaded:["+a+"], countly_boomerang loaded:["+r+"].";a&&r?(i="[DEBUG] "+i,console.log(i)):(i="[WARNING] "+i+" Initializing without APM.",console.warn(i))}t.init(e),clearInterval(c)}},s)}function r(e){var t=[];if("undefined"!=typeof e.options)for(var i=0;i<e.options.length;i++)e.options[i].selected&&t.push(e.options[i].value);return t.join(", ")}function o(){var e="xxxxxxxx";e=d(e,"[x]");var t=Date.now().toString();return e+t}function s(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";return e=d(e,"[xy]"),e}function d(e,t){var i=new Date().getTime(),n=new RegExp(t,"g");return e.replace(n,function(e){var t=0|(i+16*Math.random())%16;return("x"===e?t:8|3&t).toString(16)})}function c(){return n(new Date().getTime()/1e3)}function l(){var e=new Date().getTime();return q>=e?q++:q=e,q}function g(e,i,n){if(i&&Object.keys(i).length){if("undefined"!=typeof i[e])return i[e];}else if("undefined"!=typeof t[e])return t[e];return n}function _(e,i,n){for(var a in t.i)t.i[a].tracking_crashes&&t.i[a].recordError(e,i,n)}function u(e){var t=[];for(var n in e)t.push(n+"="+encodeURIComponent(e[n]));return t.join("&")}function p(e){return"string"==typeof e&&"/"===e.substring(e.length-1)?e.substring(0,e.length-1):e}function m(e,t){for(var n,a={},r=0,o=t.length;r<o;r++)n=t[r],"undefined"!=typeof e[n]&&(a[n]=e[n]);return a}function y(e,t,n){if(n){for(var a,r=0,o=n.length;void 0>r;r++)a=n[r],"undefined"!=typeof t[a]&&(e[a]=t[a]);return e}}function h(t,n,a,r,o,s){var d={};if(t){if(Object.keys(t).length>r){var c={},l=0;for(var g in t)l<r&&(c[g]=t[g],l++);t=c}for(var _ in t){var u=f(_,n,o,s),p=f(t[_],a,o,s);d[u]=p}}return d}function f(e,t,i,n){var a=e;return"number"==typeof e&&(e=e.toString()),"string"==typeof e&&e.length>t&&(a=e.substring(0,t),n(W.DEBUG,i+", Key: [ "+e+" ] is longer than accepted length. It will be truncated.")),a}function E(e){if(e)return e;var t=navigator.userAgent;return!t&&navigator.userAgentData&&(t=navigator.userAgentData.brands.map(function(t){return t.brand+":"+t.version}).join(),t+=navigator.userAgentData.mobile?" mobi ":" ",t+=navigator.userAgentData.platform),t}function v(e){var t;if(e)t=e;else{if(navigator.userAgentData.mobile)return"phone";t=E()}t=t.toLowerCase();var i="desktop",n=/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/,a=/(mobi|ipod|phone|blackberry|opera mini|fennec|minimo|symbian|psp|nintendo ds|archos|skyfire|puffin|blazer|bolt|gobrowser|iris|maemo|semc|teashark|uzard)/;return n.test(t)?i="tablet":a.test(t)&&(i="phone"),i}function k(e){var t=/(CountlySiteBot|nuhk|Googlebot|GoogleSecurityScanner|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver|bingbot|Google Web Preview|Mediapartners-Google|AdsBot-Google|Baiduspider|Ezooms|YahooSeeker|AltaVista|AVSearch|Mercator|Scooter|InfoSeek|Ultraseek|Lycos|Wget|YandexBot|Yandex|YaDirectFetcher|SiteBot|Exabot|AhrefsBot|MJ12bot|TurnitinBot|magpie-crawler|Nutch Crawler|CMS Crawler|rogerbot|Domnutch|ssearch_bot|XoviBot|netseer|digincore|fr-crawler|wesee|AliasIO|contxbot|PingdomBot|BingPreview|HeadlessChrome)/;return t.test(e||E())}function R(t){return"undefined"==typeof t.pageY&&"number"==typeof t.clientX&&document.documentElement&&(t.pageX=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,t.pageY=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),t}function b(){var e=document;return i(i(e.body.scrollHeight,e.documentElement.scrollHeight),i(e.body.offsetHeight,e.documentElement.offsetHeight),i(e.body.clientHeight,e.documentElement.clientHeight))}function I(){var e=document;return i(i(e.body.scrollWidth,e.documentElement.scrollWidth),i(e.body.offsetWidth,e.documentElement.offsetWidth),i(e.body.clientWidth,e.documentElement.clientWidth))}function N(){var e=Math.min,t=document;return e(e(t.body.clientHeight,t.documentElement.clientHeight),e(t.body.offsetHeight,t.documentElement.offsetHeight),window.innerHeight)}function w(){return window.innerWidth>window.innerHeight?"landscape":"portrait"}function S(e,t,i,n,a,r){var o,s=document.createElement(e);s.setAttribute(t,i),s.setAttribute(n,a);var d=function(){o||r(),o=!0};r&&(s.onreadystatechange=d,s.onload=d),document.getElementsByTagName("head")[0].appendChild(s)}function O(e,t){S("script","type","text/javascript","src",e,t)}function x(e,t){S("link","rel","stylesheet","href",e,t)}function A(){var e=document.getElementById("cly-loader");if(!e){var i="#cly-loader {height: 4px; width: 100%; position: absolute; z-index: 99999; overflow: hidden; background-color: #fff; top:0px; left:0px;}#cly-loader:before{display: block; position: absolute; content: ''; left: -200px; width: 200px; height: 4px; background-color: #2EB52B; animation: cly-loading 2s linear infinite;}@keyframes cly-loading { from {left: -200px; width: 30%;} 50% {width: 30%;} 70% {width: 70%;} 80% { left: 50%;} 95% {left: 120%;} to {left: 100%;}}",n=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText="#cly-loader {height: 4px; width: 100%; position: absolute; z-index: 99999; overflow: hidden; background-color: #fff; top:0px; left:0px;}#cly-loader:before{display: block; position: absolute; content: ''; left: -200px; width: 200px; height: 4px; background-color: #2EB52B; animation: cly-loading 2s linear infinite;}@keyframes cly-loading { from {left: -200px; width: 30%;} 50% {width: 30%;} 70% {width: 70%;} 80% { left: 50%;} 95% {left: 120%;} to {left: 100%;}}":a.appendChild(document.createTextNode("#cly-loader {height: 4px; width: 100%; position: absolute; z-index: 99999; overflow: hidden; background-color: #fff; top:0px; left:0px;}#cly-loader:before{display: block; position: absolute; content: ''; left: -200px; width: 200px; height: 4px; background-color: #2EB52B; animation: cly-loading 2s linear infinite;}@keyframes cly-loading { from {left: -200px; width: 30%;} 50% {width: 30%;} 70% {width: 70%;} 80% { left: 50%;} 95% {left: 120%;} to {left: 100%;}}")),n.appendChild(a),e=document.createElement("div"),e.setAttribute("id","cly-loader"),document.body.onload=function(){if(!t.showLoaderProtection)try{document.body.appendChild(e)}catch(t){}}}e.style.display="block"}function D(){t.showLoaderProtection=!0;var e=document.getElementById("cly-loader");e&&(e.style.display="none")}if("undefined"!=typeof window){t=t||{};var C={SESSIONS:"sessions",EVENTS:"events",VIEWS:"views",SCROLLS:"scrolls",CLICKS:"clicks",FORMS:"forms",CRASHES:"crashes",ATTRIBUTION:"attribution",USERS:"users",STAR_RATING:"star-rating",LOCATION:"location",APM:"apm",FEEDBACK:"feedback",REMOTE_CONFIG:"remote-config"};t.features=[C.SESSIONS,C.EVENTS,C.VIEWS,C.SCROLLS,C.CLICKS,C.FORMS,C.CRASHES,C.ATTRIBUTION,C.USERS,C.STAR_RATING,C.LOCATION,C.APM,C.FEEDBACK,C.REMOTE_CONFIG];var T={NPS:"[CLY]_nps",SURVEY:"[CLY]_survey",STAR_RATING:"[CLY]_star_rating",VIEW:"[CLY]_view",ORIENTATION:"[CLY]_orientation",ACTION:"[CLY]_action"},L=Object.values(T),W={ERROR:"[ERROR] ",WARNING:"[WARNING] ",INFO:"[INFO] ",DEBUG:"[DEBUG] ",VERBOSE:"[VERBOSE] "},B={DEVELOPER_SUPPLIED:0,SDK_GENERATED:1,TEMPORARY_ID:2,URL_PROVIDED:3},U={BEAT_INTERVAL:500,QUEUE_SIZE:1e3,FAIL_TIMEOUT_AMOUNT:60,INACTIVITY_TIME:20,SESSION_UPDATE:60,MAX_EVENT_BATCH:100,SESSION_COOKIE_TIMEOUT:30,MAX_KEY_LENGTH:128,MAX_VALUE_SIZE:256,MAX_SEGMENTATION_VALUES:100,MAX_BREADCRUMB_COUNT:100,MAX_STACKTRACE_LINES_PER_THREAD:30,MAX_STACKTRACE_LINE_LENGTH:200},G={BOOMERANG_SRC:"https://cdn.jsdelivr.net/npm/countly-sdk-web@latest/plugin/boomerang/boomerang.min.js",CLY_BOOMERANG_SRC:"https://cdn.jsdelivr.net/npm/countly-sdk-web@latest/plugin/boomerang/countly_boomerang.js"},F=Object.freeze({errorCount:"cly_hc_error_count",warningCount:"cly_hc_warning_count",statusCode:"cly_hc_status_code",errorMessage:"cly_hc_error_message"});t.q=t.q||[],t.onload=t.onload||[];var z="javascript_native_web",V=/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,P=!0,M=function(e){var a=Math.round;function d(t,i){if(xe.ignore_visitor)return void re(W.ERROR,"Adding event failed. Possible bot or user opt out");if(!t.key)return void re(W.ERROR,"Adding event failed. Event must have a key property");t.count||(t.count=1),L.includes(t.key)||(t.key=f(t.key,xe.maxKeyLength,"add_cly_event",re)),t.segmentation=h(t.segmentation,xe.maxKeyLength,xe.maxValueSize,xe.maxSegmentationValues,"add_cly_event",re);var n=["key","count","sum","dur","segmentation"],a=m(t,n);a.timestamp=l();var e=new Date;a.hour=e.getHours(),a.dow=e.getDay(),a.id=i||o(),a.key===T.VIEW?a.pvid=ht||"":a.cvid=yt||"",Ue.push(a),Ee("cly_event",Ue),re(W.INFO," With event ID: ["+a.id+"], successfully adding the last event:",a)}function S(e,t,i,n,a){re(W.INFO,"fetch_remote_config_explicit, Fetching sequence initiated");var r={method:"rc"};e&&(r.keys=JSON.stringify(e)),t&&(r.omit_keys=JSON.stringify(t));var o;"legacy"===n&&(r.method="fetch_remote_config"),0===i&&(r.oi=0),1===i&&(r.oi=1),"function"==typeof a&&(o=a),xe.check_consent(C.SESSIONS)&&(r.metrics=JSON.stringify(ae())),xe.check_consent(C.REMOTE_CONFIG)?(J(r),oe("fetch_remote_config_explicit",xe.url+Te,r,function(e,t,n){if(e)return void re(W.ERROR,"fetch_remote_config_explicit, An error occurred: "+e);try{var a=JSON.parse(n);if(r.keys||r.omit_keys)for(var s in a)Ge[s]=a[s];else Ge=a;Ee("cly_remote_configs",Ge)}catch(e){re(W.ERROR,"fetch_remote_config_explicit, Had an issue while parsing the response: "+e)}o&&(re(W.INFO,"fetch_remote_config_explicit, Callback function is provided"),o(e,Ge))},!0)):(re(W.ERROR,"fetch_remote_config_explicit, Remote config requires explicit consent"),o&&o(new Error("Remote config requires explicit consent"),Ge))}function G(){xe.ignore_prefetch&&"undefined"!=typeof document.visibilityState&&"prerender"===document.visibilityState&&(xe.ignore_visitor=!0),xe.ignore_bots&&k()&&(xe.ignore_visitor=!0)}function P(){0<Ue.length&&(re(W.DEBUG,"Flushing events"),Z({events:JSON.stringify(Ue)}),Ue=[],Ee("cly_event",Ue))}function M(e,t){var i=!!document.getElementById("countly-feedback-sticker-"+e._id);if(i)return void re(W.ERROR,"Widget with same ID exists");try{var n=document.createElement("div");n.className="countly-iframe-wrapper",n.id="countly-iframe-wrapper-"+e._id;var a=document.createElement("span");a.className="countly-feedback-close-icon",a.id="countly-feedback-close-icon-"+e._id,a.innerText="x";var r=document.createElement("iframe");if(r.name="countly-feedback-iframe",r.id="countly-feedback-iframe",r.src=xe.url+"/feedback?widget_id="+e._id+"&app_key="+xe.app_key+"&device_id="+xe.device_id+"&sdk_version=23.6.0",document.body.appendChild(n),n.appendChild(a),n.appendChild(r),H(document.getElementById("countly-feedback-close-icon-"+e._id),"click",function(){document.getElementById("countly-iframe-wrapper-"+e._id).style.display="none",document.getElementById("cfbg").style.display="none"}),t){var o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.id="feedback-sticker-svg",o.setAttribute("aria-hidden","true"),o.setAttribute("data-prefix","far"),o.setAttribute("data-icon","grin"),o.setAttribute("class","svg-inline--fa fa-grin fa-w-16"),o.setAttribute("role","img"),o.setAttribute("xmlns","http://www.w3.org/2000/svg"),o.setAttribute("viewBox","0 0 496 512");var s=document.createElementNS("http://www.w3.org/2000/svg","path");s.id="smileyPathInStickerSvg",s.setAttribute("fill","white"),s.setAttribute("d","M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm105.6-151.4c-25.9 8.3-64.4 13.1-105.6 13.1s-79.6-4.8-105.6-13.1c-9.9-3.1-19.4 5.4-17.7 15.3 7.9 47.1 71.3 80 123.3 80s115.3-32.9 123.3-80c1.6-9.8-7.7-18.4-17.7-15.3zM168 240c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32z");var d=document.createElement("span");d.innerText=e.trigger_button_text;var c=document.createElement("div");c.style.color=7>e.trigger_font_color.length?"#"+e.trigger_font_color:e.trigger_font_color,c.style.backgroundColor=7>e.trigger_bg_color.length?"#"+e.trigger_bg_color:e.trigger_bg_color,c.className="countly-feedback-sticker  "+e.trigger_position+"-"+e.trigger_size,c.id="countly-feedback-sticker-"+e._id,o.appendChild(s),c.appendChild(o),c.appendChild(d),document.body.appendChild(c);var l=document.getElementById("smileyPathInStickerSvg");l&&(l.style.fill=7>e.trigger_font_color.length?"#"+e.trigger_font_color:e.trigger_font_color),H(document.getElementById("countly-feedback-sticker-"+e._id),"click",function(){document.getElementById("countly-iframe-wrapper-"+e._id).style.display="block",document.getElementById("cfbg").style.display="block"})}else document.getElementById("countly-iframe-wrapper-"+e._id).style.display="block",document.getElementById("cfbg").style.display="block"}catch(t){re(W.ERROR,"Somethings went wrong while element injecting process: "+t)}}function j(){var e;if("undefined"!=typeof xe.onload&&0<xe.onload.length){for(e=0;e<xe.onload.length;e++)"function"==typeof xe.onload[e]&&xe.onload[e](xe);xe.onload=[]}}function X(){if(Ke){var e={name:Ke};xe.check_consent(C.VIEWS)&&(d({key:T.VIEW,dur:dt?c()-He:je,segmentation:e},yt),Ke=null)}}function Q(){return Ke}function $(){if(tt){var e=fe("cly_session");(!e||parseInt(e)<=c())&&(De=!1,xe.begin_session(!Me)),Ee("cly_session",c()+60*nt)}}function J(e){e.app_key=xe.app_key,e.device_id=xe.device_id,e.sdk_name=z,e.sdk_version="23.6.0",e.t=_t;var t=ne();if(!e.metrics)e.metrics=JSON.stringify({_ua:t});else{var i=JSON.parse(e.metrics);i._ua||(i._ua=t,e.metrics=JSON.stringify(i))}xe.check_consent(C.LOCATION)?(xe.country_code&&(e.country_code=xe.country_code),xe.city&&(e.city=xe.city),null!==xe.ip_address&&(e.ip_address=xe.ip_address)):e.location="",e.timestamp=l();var n=new Date;e.hour=n.getHours(),e.dow=n.getDay()}function Z(e){return xe.ignore_visitor?void re(W.WARNING,"User is opt_out will ignore the request: "+e):xe.app_key&&xe.device_id?void(J(e),Be.length>We&&Be.shift(),Be.push(e),Ee("cly_queue",Be,!0)):void re(W.ERROR,"app_key or device_id is missing ",xe.app_key,xe.device_id)}function ee(){if(j(),xe.ignore_visitor)return rt=!1,void re(W.WARNING,"User opt_out, no heartbeat");rt=!0;var e=0;if(Ae&&"undefined"!=typeof t.q&&0<t.q.length){var n,a=t.q;for(t.q=[],e=0;e<a.length;e++)if(n=a[e],re(W.DEBUG,"Processing queued call",n),"function"==typeof n)n();else if(Array.isArray(n)&&0<n.length){var r=xe,o=0;if(t.i[n[o]]&&(r=t.i[n[o]],o++),"function"==typeof r[n[o]])r[n[o]].apply(r,n.slice(o+1));else if(0===n[o].indexOf("userData.")){var s=n[o].replace("userData.","");"function"==typeof r.userData[s]&&r.userData[s].apply(r,n.slice(o+1))}else"function"==typeof t[n[o]]?t[n[o]].apply(t,n.slice(o+1)):console.error("The argument"+n[o]+" is invalid, if you want use 'add_event', please use add_business_event or add_technology_event instead!")}}if(De&&Me&&dt){var d=c();d-Oe>Je&&(xe.session_duration(d-Oe),Oe=d,0<xe.hcErrorCount&&Ee(F.errorCount,xe.hcErrorCount),0<xe.hcWarningCount&&Ee(F.warningCount,xe.hcWarningCount))}if(0<Ue.length&&!xe.test_mode_eq){if(Ue.length<=Ze)Z({events:JSON.stringify(Ue)}),Ue=[];else{var l=Ue.splice(0,Ze);Z({events:JSON.stringify(l)})}Ee("cly_event",Ue)}if(!ot&&0<Be.length&&at&&c()>Ye){at=!1;var g=Be[0];g.rr=Be.length,re(W.DEBUG,"Processing request",g),Ee("cly_queue",Be,!0),xe.test_mode||oe("send_request_queue",xe.url+Ce,g,function(e,t){re(W.DEBUG,"Request Finished",t,e),e?(Ye=c()+Xe,re(W.ERROR,"Request error: ",e)):Be.shift(),Ee("cly_queue",Be,!0),at=!0},!1)}setTimeout(ee,Le)}function te(){var e=fe("cly_id");return e?(_t=fe("cly_id_type"),e):s()}function ie(e){return /[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-4[0-9a-fA-F]{3}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}/.test(e)}function ne(){return xe.metrics._ua||E()}function ae(){var e=Math.abs,t=JSON.parse(JSON.stringify(xe.metrics||{}));if(t._app_version=t._app_version||xe.app_version,t._ua=t._ua||E(),screen.width){var i=screen.width?parseInt(screen.width):0,n=screen.height?parseInt(screen.height):0;if(0!==i&&0!==n){var r=!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform);if(r&&window.devicePixelRatio)i=a(i*window.devicePixelRatio),n=a(n*window.devicePixelRatio);else if(90===e(window.orientation)){var o=i;i=n,n=o}t._resolution=t._resolution||""+i+"x"+n}}window.devicePixelRatio&&(t._density=t._density||window.devicePixelRatio);var s=navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage;if("undefined"!=typeof s&&(t._locale=t._locale||s),"undefined"!=typeof document.referrer&&document.referrer.length){var d=V.exec(document.referrer);if(d&&d[11]&&d[11]!==window.location.hostname){var c=!1;if(Ve&&Ve.length)for(var l=0;l<Ve.length;l++)try{var g=new RegExp(Ve[l]);if(g.test(document.referrer)){re(W.DEBUG,"Ignored: "+document.referrer),c=!0;break}}catch(e){re(W.ERROR,"Problem with ignoring: "+Ve[l],", error: "+e)}c||(t._store=t._store||document.referrer)}}return re(W.DEBUG,"Got metrics",t),t}function re(e,t){if(xe.debug&&"undefined"!=typeof console){arguments[2]&&"object"==typeof arguments[2]&&(arguments[2]=JSON.stringify(arguments[2])),Ae||(t="["+xe.app_key+"] "+t),e||(e=W.DEBUG);for(var n="",a=2;a<arguments.length;a++)n+=arguments[a];var r=e+t+n;e===W.ERROR?(console.error(r),bt.incrementErrorCount()):e===W.WARNING?(console.warn(r),bt.incrementWarningCount()):e===W.INFO?console.info(r):e===W.VERBOSE?console.log(r):console.debug(r)}}function oe(t,i,n,a,r){r=r||!1;try{re(W.DEBUG,"Sending XML HTTP request");var o=null;window.XMLHttpRequest?o=new window.XMLHttpRequest:window.ActiveXObject&&(o=new window.ActiveXObject("Microsoft.XMLHTTP")),n=n||{};var s=u(n),d="GET";for(var c in(xe.force_post||2e3<=s.length)&&(d="POST"),"GET"===d?o.open("GET",i+"?"+s,!0):(o.open("POST",i,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded")),xe.headers)o.setRequestHeader(c,xe.headers[c]);o.onreadystatechange=function(){if(4===this.readyState){re(W.DEBUG,t+" HTTP request completed ["+this.status+"]["+this.responseText+"]");var e;e=r?de(this.status,this.responseText):se(this.status,this.responseText),e?"function"==typeof a&&a(!1,n,this.responseText):(re(W.ERROR,t+" Failed Server XML HTTP request, ",this.status),"send_request_queue"===t&&bt.saveRequestCounters(this.status,this.responseText),"function"==typeof a&&a(!0,n,this.status,this.responseText))}},"GET"===d?o.send():o.send(s)}catch(i){re(W.ERROR,t+" Failed XML HTTP request: "+i),"function"==typeof a&&a(!0,n)}}function se(e,t){if(!(200<=e&&300>e))return re(W.ERROR,"Http response status code is not within the expected range:["+e+"]"),!1;try{var i=JSON.parse(t);return"[object Object]"===Object.prototype.toString.call(i)?!!i.result:(re(W.ERROR,"Http response is not JSON Object"),!1)}catch(t){return re(W.ERROR,"Http response is not JSON: "+t),!1}}function de(e,t){if(!(200<=e&&300>e))return re(W.ERROR,"Http response status code is not within the expected range: "+e),!1;try{var i=JSON.parse(t);return!!("[object Object]"===Object.prototype.toString.call(i)||Array.isArray(i))||(re(W.ERROR,"Http response is not JSON Object nor JSON Array"),!1)}catch(t){return re(W.ERROR,"Http response is not JSON: "+t),!1}}function ce(){pt=i(pt,window.scrollY,document.body.scrollTop,document.documentElement.scrollTop)}function le(){if(ut){ut=!1;var e=b(),t=I(),i=N();if(xe.check_consent(C.SCROLLS)){var n={type:"scroll",y:pt+i,width:t,height:e,view:xe.getViewUrl()};n=h(n,xe.maxKeyLength,xe.maxValueSize,xe.maxSegmentationValues,"processScrollView",re),xe.track_domains&&(n.domain=window.location.hostname),d({key:T.ACTION,segmentation:n})}}}function ge(){return _t}function _e(e){Ee("cly_token",e)}function ue(){var e=fe("cly_token");return ve("cly_token"),e}function pe(){return Ue}function me(){return Be}function ye(e){for(var t,n=e+"=",a=document.cookie.split(";"),r=0,o=a.length;r<o;r++){for(t=a[r];" "===t.charAt(0);)t=t.substring(1,t.length);if(0===t.indexOf(n))return t.substring(n.length,t.length)}return null}function he(e,t,i){var n=new Date;n.setTime(n.getTime()+1e3*(60*(60*(24*i))));var a="; expires="+n.toGMTString();document.cookie=e+"="+t+a+"; path=/"}function fe(e,t,i){if("none"===xe.storage)return void re(W.WARNING,"Storage is disabled. Value with key: "+e+" won't be retrieved");i||(e=xe.app_key+"/"+e,xe.namespace&&(e=p(xe.namespace)+"/"+e)),void 0===t&&(t=lt);var n;return t?n=localStorage.getItem(e):"localstorage"!==xe.storage&&(n=ye(e)),xe.deserialize(n)}function Ee(e,t,i,n){return"none"===xe.storage?void re(W.WARNING,"Storage is disabled. Value with key: "+e+" won't be stored"):void(!n&&(e=xe.app_key+"/"+e,xe.namespace&&(e=p(xe.namespace)+"/"+e)),void 0===i&&(i=lt),"undefined"!=typeof t&&null!==t&&(t=xe.serialize(t),i?localStorage.setItem(e,t):"localstorage"!==xe.storage&&he(e,t,30)))}function ve(e,t,i){return"none"===xe.storage?void re(W.WARNING,"Storage is disabled. Value with key: "+e+" won't be removed"):void(!i&&(e=xe.app_key+"/"+e,xe.namespace&&(e=p(xe.namespace)+"/"+e)),void 0===t&&(t=lt),t?localStorage.removeItem(e):"localstorage"!==xe.storage&&he(e,"",-1))}function ke(){if(fe(xe.namespace+"cly_id",!1,!0)){Ee("cly_id",fe(xe.namespace+"cly_id",!1,!0)),Ee("cly_id_type",fe(xe.namespace+"cly_id_type",!1,!0)),Ee("cly_event",fe(xe.namespace+"cly_event",!1,!0)),Ee("cly_session",fe(xe.namespace+"cly_session",!1,!0));var e=fe(xe.namespace+"cly_queue",!1,!0);Array.isArray(e)&&(e=e.filter(function(e){return e.app_key===xe.app_key}),Ee("cly_queue",e)),fe(xe.namespace+"cly_cmp_id",!1,!0)&&(Ee("cly_cmp_id",fe(xe.namespace+"cly_cmp_id",!1,!0)),Ee("cly_cmp_uid",fe(xe.namespace+"cly_cmp_uid",!1,!0))),fe(xe.namespace+"cly_ignore",!1,!0)&&Ee("cly_ignore",fe(xe.namespace+"cly_ignore",!1,!0)),ve("cly_id",!1,!0),ve("cly_id_type",!1,!0),ve("cly_event",!1,!0),ve("cly_session",!1,!0),ve("cly_queue",!1,!0),ve("cly_cmp_id",!1,!0),ve("cly_cmp_uid",!1,!0),ve("cly_ignore",!1,!0)}}function Re(){xe.hcErrorCount++}function be(){xe.hcWarningCount++}function Ie(){xe.hcErrorCount=0,xe.hcWarningCount=0,xe.hcStatusCode=-1,xe.hcErrorMessage=""}function Ne(e,t){xe.hcStatusCode=e,xe.hcErrorMessage=t,Ee(F.statusCode,xe.hcStatusCode),Ee(F.errorMessage,xe.hcErrorMessage)}function we(){bt.resetCounters(),Ee(F.errorCount,xe.hcErrorCount),Ee(F.warningCount,xe.hcWarningCount),Ee(F.statusCode,xe.hcStatusCode),Ee(F.errorMessage,xe.hcErrorMessage)}function Se(){var e=f(xe.hcErrorMessage,1e3,"healthCheck",re),t={el:xe.hcErrorCount,wl:xe.hcWarningCount,sc:xe.hcStatusCode,em:JSON.stringify(e)},i={hc:JSON.stringify(t),metrics:JSON.stringify({_app_version:xe.app_version})};J(i),oe("healthCheck",xe.url+Ce,i,function(e,t,i,n){e?re(W.ERROR,"healthCheck, An error occurred. Status: ["+i+"], response: ["+n+"]"):(re(W.INFO,"healthCheck, Request was successful. Status: ["+i+"], response: ["+n+"]"),bt.resetAndSaveCounters())},!0)}var Oe,xe=this,Ae=!t.i,De=!1,Ce="/i",Te="/o/sdk",Le=g("interval",e,U.BEAT_INTERVAL),We=g("queue_size",e,U.QUEUE_SIZE),Be=[],Ue=[],Ge={},Fe=[],ze={},Ve=g("ignore_referrers",e,[]),Pe=null,Me=!0,qe=0,Ke=null,He=0,je=0,Ye=0,Xe=g("fail_timeout",e,U.FAIL_TIMEOUT_AMOUNT),Qe=g("inactivity_time",e,U.INACTIVITY_TIME),$e=0,Je=g("session_update",e,U.SESSION_UPDATE),Ze=g("max_events",e,U.MAX_EVENT_BATCH),et=g("max_logs",e,null),tt=g("use_session_cookie",e,!0),nt=g("session_cookie_timeout",e,U.SESSION_COOKIE_TIMEOUT),at=!0,rt=!1,ot=g("offline_mode",e,!1),st={},dt=!0,ct=c(),lt=!0,gt=null,_t=B.SDK_GENERATED,ut=!1,pt=0,mt=!1,yt=null,ht=null;try{localStorage.setItem("cly_testLocal",!0),localStorage.removeItem("cly_testLocal")}catch(t){re(W.ERROR,"Local storage test failed, Halting local storage support: "+t),lt=!1}for(var ft={},Et=0;Et<t.features.length;Et++)ft[t.features[Et]]={};this.initialize=function(){if(this.serialize=g("serialize",e,t.serialize),this.deserialize=g("deserialize",e,t.deserialize),this.getViewName=g("getViewName",e,t.getViewName),this.getViewUrl=g("getViewUrl",e,t.getViewUrl),this.getSearchQuery=g("getSearchQuery",e,t.getSearchQuery),this.DeviceIdType=t.DeviceIdType,this.namespace=g("namespace",e,""),this.clearStoredId=g("clear_stored_id",e,!1),this.app_key=g("app_key",e,null),this.onload=g("onload",e,[]),this.utm=g("utm",e,{source:!0,medium:!0,campaign:!0,term:!0,content:!0}),this.ignore_prefetch=g("ignore_prefetch",e,!0),this.rcAutoOptinAb=g("rc_automatic_optin_for_ab",e,!0),this.useExplicitRcApi=g("use_explicit_rc_api",e,!1),this.debug=g("debug",e,!1),this.test_mode=g("test_mode",e,!1),this.test_mode_eq=g("test_mode_eq",e,!1),this.metrics=g("metrics",e,{}),this.headers=g("headers",e,{}),this.url=p(g("url",e,"")),this.app_version=g("app_version",e,"0.0"),this.country_code=g("country_code",e,null),this.city=g("city",e,null),this.ip_address=g("ip_address",e,null),this.ignore_bots=g("ignore_bots",e,!0),this.force_post=g("force_post",e,!1),this.remote_config=g("remote_config",e,!1),this.ignore_visitor=g("ignore_visitor",e,!1),this.require_consent=g("require_consent",e,!1),this.track_domains=g("track_domains",e,!0),this.storage=g("storage",e,"default"),this.enableOrientationTracking=g("enable_orientation_tracking",e,!0),this.maxKeyLength=g("max_key_length",e,U.MAX_KEY_LENGTH),this.maxValueSize=g("max_value_size",e,U.MAX_VALUE_SIZE),this.maxSegmentationValues=g("max_segmentation_values",e,U.MAX_SEGMENTATION_VALUES),this.maxBreadcrumbCount=g("max_breadcrumb_count",e,null),this.maxStackTraceLinesPerThread=g("max_stack_trace_lines_per_thread",e,U.MAX_STACKTRACE_LINES_PER_THREAD),this.maxStackTraceLineLength=g("max_stack_trace_line_length",e,U.MAX_STACKTRACE_LINE_LENGTH),this.heatmapWhitelist=g("heatmap_whitelist",e,[]),xe.hcErrorCount=fe(F.errorCount)||0,xe.hcWarningCount=fe(F.warningCount)||0,xe.hcStatusCode=fe(F.statusCode)||-1,xe.hcErrorMessage=fe(F.errorMessage)||"",et&&!this.maxBreadcrumbCount?(this.maxBreadcrumbCount=et,re(W.WARNING,"initialize, 'maxCrashLogs' is deprecated. Use 'maxBreadcrumbCount' instead!")):!et&&!this.maxBreadcrumbCount&&(this.maxBreadcrumbCount=100),"cookie"===this.storage&&(lt=!1),this.rcAutoOptinAb||this.useExplicitRcApi||(re(W.WARNING,"initialize, Auto opting is disabled, switching to explicit RC API"),this.useExplicitRcApi=!0),Array.isArray(Ve)||(Ve=[]),""===this.url&&(re(W.ERROR,"initialize, Please provide server URL"),this.ignore_visitor=!0),fe("cly_ignore")&&(this.ignore_visitor=!0),ke(),Be=fe("cly_queue")||[],Ue=fe("cly_event")||[],Ge=fe("cly_remote_configs")||{},this.clearStoredId&&(fe("cly_id")&&!0&&(this.device_id=fe("cly_id"),re(W.DEBUG,"initialize, temporarily using the previous device ID to flush existing events"),_t=fe("cly_id_type"),!_t&&(re(W.DEBUG,"initialize, No device ID type info from the previous session, falling back to DEVELOPER_SUPPLIED, for event flushing"),_t=B.DEVELOPER_SUPPLIED),P(),this.device_id=void 0,_t=B.SDK_GENERATED),re(W.INFO,"initialize, Clearing the device ID storage"),localStorage.removeItem(this.app_key+"/cly_id"),localStorage.removeItem(this.app_key+"/cly_id_type"),localStorage.removeItem(this.app_key+"/cly_session")),G(),window.name&&0===window.name.indexOf("cly:"))try{this.passed_data=JSON.parse(window.name.replace("cly:",""))}catch(e){re(W.ERROR,"initialize, Could not parse name: "+window.name+", error: "+e)}else if(location.hash&&0===location.hash.indexOf("#cly:"))try{this.passed_data=JSON.parse(location.hash.replace("#cly:",""))}catch(e){re(W.ERROR,"initialize, Could not parse hash: "+location.hash+", error: "+e)}if((this.passed_data&&this.passed_data.app_key&&this.passed_data.app_key===this.app_key||this.passed_data&&!this.passed_data.app_key&&Ae)&&this.passed_data.token&&this.passed_data.purpose){this.passed_data.token!==fe("cly_old_token")&&(_e(this.passed_data.token),Ee("cly_old_token",this.passed_data.token));var n=[];Array.isArray(this.heatmapWhitelist)?(this.heatmapWhitelist.push(this.url),n=this.heatmapWhitelist.map(function(t){return p(t)})):n=[this.url],n.includes(this.passed_data.url)&&"heatmap"===this.passed_data.purpose&&(this.ignore_visitor=!0,A(),O(this.passed_data.url+"/views/heatmap.js",D))}if(this.ignore_visitor)return void re(W.WARNING,"initialize, ignore_visitor:["+this.ignore_visitor+"], this user will not be tracked");re(W.DEBUG,"initialize, app_key:["+this.app_key+"], url:["+this.url+"]"),re(W.DEBUG,"initialize, device_id:["+g("device_id",e,void 0)+"]"),re(W.DEBUG,"initialize, require_consent is enabled:["+this.require_consent+"]");try{re(W.DEBUG,"initialize, metric override:["+JSON.stringify(this.metrics)+"]"),re(W.DEBUG,"initialize, header override:["+JSON.stringify(this.headers)+"]"),re(W.DEBUG,"initialize, number of onload callbacks provided:["+this.onload.length+"]"),re(W.DEBUG,"initialize, utm tags:["+JSON.stringify(this.utm)+"]"),Ve&&re(W.DEBUG,"initialize, referrers to ignore :["+JSON.stringify(Ve)+"]")}catch(t){re(W.ERROR,"initialize, Could not stringify some config object values")}re(W.DEBUG,"initialize, app_version:["+this.app_version+"]"),re(W.DEBUG,"initialize, provided location info; country_code:["+this.country_code+"], city:["+this.city+"], ip_address:["+this.ip_address+"]"),""!==this.namespace&&re(W.DEBUG,"initialize, namespace given:["+this.namespace+"]"),this.clearStoredId&&re(W.DEBUG,"initialize, clearStoredId flag set to:["+this.clearStoredId+"]"),this.ignore_prefetch&&re(W.DEBUG,"initialize, ignoring pre-fetching and pre-rendering from counting as real website visits :["+this.ignore_prefetch+"]"),this.test_mode&&re(W.WARNING,"initialize, test_mode:["+this.test_mode+"], request queue won't be processed"),this.test_mode_eq&&re(W.WARNING,"initialize, test_mode_eq:["+this.test_mode_eq+"], event queue won't be processed"),this.heatmapWhitelist&&re(W.DEBUG,"initialize, heatmap whitelist:["+JSON.stringify(this.heatmapWhitelist)+"], these domains will be whitelisted"),"default"!==this.storage&&re(W.DEBUG,"initialize, storage is set to:["+this.storage+"]"),this.ignore_bots&&re(W.DEBUG,"initialize, ignore traffic from bots :["+this.ignore_bots+"]"),this.force_post&&re(W.DEBUG,"initialize, forced post method for all requests:["+this.force_post+"]"),this.remote_config&&re(W.DEBUG,"initialize, remote_config callback provided:["+!!this.remote_config+"]"),"boolean"==typeof this.rcAutoOptinAb&&re(W.DEBUG,"initialize, automatic RC optin is enabled:["+this.rcAutoOptinAb+"]"),this.useExplicitRcApi||re(W.WARNING,"initialize, will use legacy RC API. Consider enabling new API during init with use_explicit_rc_api flag"),this.track_domains&&re(W.DEBUG,"initialize, tracking domain info:["+this.track_domains+"]"),this.enableOrientationTracking&&re(W.DEBUG,"initialize, enableOrientationTracking:["+this.enableOrientationTracking+"]"),tt||re(W.WARNING,"initialize, use_session_cookie is enabled:["+tt+"]"),ot&&re(W.DEBUG,"initialize, offline_mode:["+ot+"], user info won't be send to the servers"),ot&&re(W.DEBUG,"initialize, stored remote configs:["+JSON.stringify(Ge)+"]"),re(W.DEBUG,"initialize, 'getViewName' callback override provided:["+(this.getViewName!==t.getViewName)+"]"),re(W.DEBUG,"initialize, 'getSearchQuery' callback override provided:["+(this.getSearchQuery!==t.getSearchQuery)+"]"),this.maxKeyLength!==U.MAX_KEY_LENGTH&&re(W.DEBUG,"initialize, maxKeyLength set to:["+this.maxKeyLength+"] characters"),this.maxValueSize!==U.MAX_VALUE_SIZE&&re(W.DEBUG,"initialize, maxValueSize set to:["+this.maxValueSize+"] characters"),this.maxSegmentationValues!==U.MAX_SEGMENTATION_VALUES&&re(W.DEBUG,"initialize, maxSegmentationValues set to:["+this.maxSegmentationValues+"] key/value pairs"),this.maxBreadcrumbCount!==U.MAX_BREADCRUMB_COUNT&&re(W.DEBUG,"initialize, maxBreadcrumbCount for custom logs set to:["+this.maxBreadcrumbCount+"] entries"),this.maxStackTraceLinesPerThread!==U.MAX_STACKTRACE_LINES_PER_THREAD&&re(W.DEBUG,"initialize, maxStackTraceLinesPerThread set to:["+this.maxStackTraceLinesPerThread+"] lines"),this.maxStackTraceLineLength!==U.MAX_STACKTRACE_LINE_LENGTH&&re(W.DEBUG,"initialize, maxStackTraceLineLength set to:["+this.maxStackTraceLineLength+"] characters"),Le!==U.BEAT_INTERVAL&&re(W.DEBUG,"initialize, interval for heartbeats set to:["+Le+"] milliseconds"),We!==U.QUEUE_SIZE&&re(W.DEBUG,"initialize, queue_size set to:["+We+"] items max"),Xe!==U.FAIL_TIMEOUT_AMOUNT&&re(W.DEBUG,"initialize, fail_timeout set to:["+Xe+"] seconds of wait time after a failed connection to server"),Qe!==U.INACTIVITY_TIME&&re(W.DEBUG,"initialize, inactivity_time set to:["+Qe+"] minutes to consider a user as inactive after no observable action"),Je!==U.SESSION_UPDATE&&re(W.DEBUG,"initialize, session_update set to:["+Je+"] seconds to check if extending a session is needed while the user is active"),Ze!==U.MAX_EVENT_BATCH&&re(W.DEBUG,"initialize, max_events set to:["+Ze+"] events to send in one batch"),et&&re(W.WARNING,"initialize, max_logs set to:["+et+"] breadcrumbs to store for crash logs max, deprecated "),nt!==U.SESSION_COOKIE_TIMEOUT&&re(W.DEBUG,"initialize, session_cookie_timeout set to:["+nt+"] minutes to expire a cookies session"),re(W.INFO,"initialize, Countly initialized");var a=null,r=xe.getSearchQuery(),o=!1,s={};if(r)for(var d,c=r.substring(1).split("&"),l=0;l<c.length;l++)d=c[l].split("="),"cly_id"===d[0]?Ee("cly_cmp_id",d[1]):"cly_uid"===d[0]?Ee("cly_cmp_uid",d[1]):"cly_device_id"===d[0]?a=d[1]:0===(d[0]+"").indexOf("utm_")&&this.utm[d[0].replace("utm_","")]&&(s[d[0].replace("utm_","")]=d[1],o=!0);var _="[CLY]_temp_id"===fe("cly_id"),u=g("device_id",e,void 0);if(fe("cly_id")&&!_?(this.device_id=fe("cly_id"),re(W.INFO,"initialize, Set the stored device ID"),_t=fe("cly_id_type"),!_t&&(re(W.INFO,"initialize, No device ID type info from the previous session, falling back to DEVELOPER_SUPPLIED"),_t=B.DEVELOPER_SUPPLIED)):null===a?u?(re(W.INFO,"initialize, Device ID set by developer"),this.device_id=u,e&&Object.keys(e).length?void 0!==e.device_id&&(_t=B.DEVELOPER_SUPPLIED):void 0!==t.device_id&&(_t=B.DEVELOPER_SUPPLIED)):ot||_?(this.device_id="[CLY]_temp_id",_t=B.TEMPORARY_ID,ot&&_?re(W.INFO,"initialize, Temp ID set, continuing offline mode from previous app session"):ot&&!_?re(W.INFO,"initialize, Temp ID set, entering offline mode"):(ot=!0,re(W.INFO,"initialize, Temp ID set, enabling offline mode"))):(re(W.INFO,"initialize, Generating the device ID"),this.device_id=g("device_id",e,te()),e&&Object.keys(e).length?void 0!==e.device_id&&(_t=B.DEVELOPER_SUPPLIED):void 0!==t.device_id&&(_t=B.DEVELOPER_SUPPLIED)):(re(W.INFO,"initialize, Device ID set by URL"),this.device_id=a,_t=B.URL_PROVIDED),Ee("cly_id",this.device_id),Ee("cly_id_type",_t),o){for(var m in this.utm)s[m]?this.userData.set("utm_"+m,s[m]):this.userData.unset("utm_"+m);this.userData.save()}j(),setTimeout(function(){ee(),xe.remote_config&&xe.fetch_remote_config(xe.remote_config)},1),document.documentElement.setAttribute("data-countly-useragent",E()),bt.sendInstantHCRequest()},this.halt=function(){re(W.WARNING,"halt, Resetting Countly"),t.i=void 0,Ae=!t.i,De=!1,Ce="/i",Te="/o/sdk",Le=500,We=1e3,Be=[],Ue=[],Ge={},Fe=[],ze={},Ve=[],Pe=null,Me=!0,qe=0,Ke=null,He=0,je=0,Ye=0,Xe=60,Qe=20,$e=0,Je=60,Ze=100,et=null,tt=!0,nt=30,at=!0,rt=!1,ot=!1,st={},dt=!0,ct=c(),lt=!0,gt=null,_t=B.SDK_GENERATED,ut=!1,pt=0,mt=!1,yt=null,ht=null;try{localStorage.setItem("cly_testLocal",!0),localStorage.removeItem("cly_testLocal")}catch(t){re(W.ERROR,"halt, Local storage test failed, will fallback to cookies"),lt=!1}t.features=[C.SESSIONS,C.EVENTS,C.VIEWS,C.SCROLLS,C.CLICKS,C.FORMS,C.CRASHES,C.ATTRIBUTION,C.USERS,C.STAR_RATING,C.LOCATION,C.APM,C.FEEDBACK,C.REMOTE_CONFIG],ft={};for(var e=0;e<t.features.length;e++)ft[t.features[e]]={};xe.app_key=void 0,xe.device_id=void 0,xe.onload=void 0,xe.utm=void 0,xe.ignore_prefetch=void 0,xe.debug=void 0,xe.test_mode=void 0,xe.test_mode_eq=void 0,xe.metrics=void 0,xe.headers=void 0,xe.url=void 0,xe.app_version=void 0,xe.country_code=void 0,xe.city=void 0,xe.ip_address=void 0,xe.ignore_bots=void 0,xe.force_post=void 0,xe.rcAutoOptinAb=void 0,xe.useExplicitRcApi=void 0,xe.remote_config=void 0,xe.ignore_visitor=void 0,xe.require_consent=void 0,xe.track_domains=void 0,xe.storage=void 0,xe.enableOrientationTracking=void 0,xe.maxKeyLength=void 0,xe.maxValueSize=void 0,xe.maxSegmentationValues=void 0,xe.maxBreadcrumbCount=void 0,xe.maxStackTraceLinesPerThread=void 0,xe.maxStackTraceLineLength=void 0},this.group_features=function(e){if(re(W.INFO,"group_features, Grouping features"),e)for(var t in e)ft[t]?re(W.WARNING,"group_features, Feature name ["+t+"] is already reserved"):"string"==typeof e[t]?ft[t]={features:[e[t]]}:e[t]&&Array.isArray(e[t])&&e[t].length?ft[t]={features:e[t]}:re(W.ERROR,"group_features, Incorrect feature list for ["+t+"] value: ["+e[t]+"]");else re(W.ERROR,"group_features, Incorrect features:["+e+"]")},this.check_consent=function(e){return(re(W.INFO,"check_consent, Checking if consent is given for specific feature:["+e+"]"),!this.require_consent)?(re(W.INFO,"check_consent, require_consent is off, no consent is necessary"),!0):ft[e]?!!(ft[e]&&ft[e].optin):(re(W.ERROR,"check_consent, No feature available for ["+e+"]"),!1)},this.get_device_id_type=function(){re(W.INFO,"check_device_id_type, Retrieving the current device id type.["+_t+"]");var e;return e=_t===B.SDK_GENERATED?xe.DeviceIdType.SDK_GENERATED:_t===B.URL_PROVIDED||_t===B.DEVELOPER_SUPPLIED?xe.DeviceIdType.DEVELOPER_SUPPLIED:_t===B.TEMPORARY_ID?xe.DeviceIdType.TEMPORARY_ID:-1,e},this.get_device_id=function(){return re(W.INFO,"get_device_id, Retrieving the device id: ["+this.device_id+"]"),this.device_id},this.check_any_consent=function(){if(re(W.INFO,"check_any_consent, Checking if any consent is given"),!this.require_consent)return re(W.INFO,"check_any_consent, require_consent is off, no consent is necessary"),!0;for(var e in ft)if(ft[e]&&ft[e].optin)return!0;return re(W.INFO,"check_any_consent, No consents given"),!1},this.add_consent=function(e){if(re(W.INFO,"add_consent, Adding consent for ["+e+"]"),Array.isArray(e))for(var t=0;t<e.length;t++)this.add_consent(e[t]);else ft[e]?ft[e].features?(ft[e].optin=!0,this.add_consent(ft[e].features)):!0!==ft[e].optin&&(ft[e].optin=!0,vt(),setTimeout(function(){e===C.SESSIONS&&st.begin_session?(xe.begin_session.apply(xe,st.begin_session),st.begin_session=null):e===C.VIEWS&&st.track_pageview&&(Ke=null,xe.track_pageview.apply(xe,st.track_pageview),st.track_pageview=null)},1)):re(W.ERROR,"add_consent, No feature available for ["+e+"]")},this.remove_consent=function(e){re(W.INFO,"remove_consent, Removing consent for ["+e+"]"),this.remove_consent_internal(e,!0)},this.remove_consent_internal=function(e,t){if(t=t||!1,Array.isArray(e))for(var n=0;n<e.length;n++)this.remove_consent_internal(e[n],t);else ft[e]?ft[e].features?this.remove_consent_internal(ft[e].features,t):(ft[e].optin=!1,t&&!1!==ft[e].optin&&vt()):re(W.WARNING,"remove_consent, No feature available for ["+e+"]")};var q,vt=function(){q&&(clearTimeout(q),q=null),q=setTimeout(function(){for(var e={},n=0;n<t.features.length;n++)e[t.features[n]]=!0===ft[t.features[n]].optin;Z({consent:JSON.stringify(e)}),re(W.DEBUG,"Consent update request has been sent to the queue.")},1e3)};this.enable_offline_mode=function(){re(W.INFO,"enable_offline_mode, Enabling offline mode"),this.remove_consent_internal(t.features,!1),ot=!0,this.device_id="[CLY]_temp_id",xe.device_id=this.device_id,_t=B.TEMPORARY_ID},this.disable_offline_mode=function(e){if(!ot)return void re(W.WARNING,"disable_offline_mode, Countly was not in offline mode.");re(W.INFO,"disable_offline_mode, Disabling offline mode"),ot=!1,e&&this.device_id!==e?(this.device_id=e,xe.device_id=this.device_id,_t=B.DEVELOPER_SUPPLIED,Ee("cly_id",this.device_id),Ee("cly_id_type",B.DEVELOPER_SUPPLIED),re(W.INFO,"disable_offline_mode, Changing id to: "+this.device_id)):(this.device_id=te(),"[CLY]_temp_id"===this.device_id&&(this.device_id=s()),xe.device_id=this.device_id,this.device_id!==fe("cly_id")&&(Ee("cly_id",this.device_id),Ee("cly_id_type",B.SDK_GENERATED)));var t=!1;if(0<Be.length)for(var n=0;n<Be.length;n++)"[CLY]_temp_id"===Be[n].device_id&&(Be[n].device_id=this.device_id,t=!0);t&&Ee("cly_queue",Be,!0)},this.begin_session=function(e,t){if(re(W.INFO,"begin_session, Starting the session. There was an ongoing session: ["+De+"]"),e&&re(W.INFO,"begin_session, Heartbeats are disabled"),t&&re(W.INFO,"begin_session, Session starts irrespective of session cookie"),!this.check_consent(C.SESSIONS))st.begin_session=arguments;else if(!De){this.enableOrientationTracking&&(this.report_orientation(),H(window,"resize",function(){xe.report_orientation()})),Oe=c(),De=!0,Me=!e;var i=fe("cly_session");if(re(W.VERBOSE,"begin_session, Session state, forced: ["+t+"], useSessionCookie: ["+tt+"], seconds to expire: ["+(i-Oe)+"], expired: ["+(parseInt(i)<=c())+"] "),t||!tt||!i||parseInt(i)<=c()){re(W.INFO,"begin_session, Session started"),null===gt&&(gt=!0);var n={};n.begin_session=1,n.metrics=JSON.stringify(ae()),Z(n)}Ee("cly_session",c()+60*nt)}},this.session_duration=function(e){re(W.INFO,"session_duration, Reporting session duration"),this.check_consent(C.SESSIONS)&&De&&(re(W.INFO,"session_duration, Session extended: ",e),Z({session_duration:e}),$())},this.end_session=function(e,t){re(W.INFO,"end_session, Ending the current session. There was an on going session:["+De+"]"),this.check_consent(C.SESSIONS)&&De&&(e=e||c()-Oe,X(),!tt||t?(re(W.INFO,"end_session, Session ended"),Z({end_session:1,session_duration:e})):this.session_duration(e),De=!1)},this.change_id=function(e,i){if(re(W.INFO,"change_id, Changing the ID"),i&&re(W.INFO,"change_id, Will merge the IDs"),!e||"string"!=typeof e||0===e.length)return void re(W.ERROR,"change_id, The provided ID: ["+e+"] is not a valid ID");if(ot)return re(W.WARNING,"change_id, Offline mode was on, initiating disabling sequence instead."),void this.disable_offline_mode(e);if(this.device_id!=e){i||(P(),this.end_session(null,!0),ze={},this.remove_consent_internal(t.features,!1));var n=this.device_id;this.device_id=e,xe.device_id=this.device_id,_t=B.DEVELOPER_SUPPLIED,Ee("cly_id",this.device_id),Ee("cly_id_type",B.DEVELOPER_SUPPLIED),re(W.INFO,"change_id, Changing ID from:["+n+"] to ["+e+"]"),i?Z({old_device_id:n}):this.begin_session(!Me,!0),this.remote_config&&(Ge={},Ee("cly_remote_configs",Ge),this.fetch_remote_config(this.remote_config))}},this.add_business_event=function(e){return e&&"object"==typeof e?void this.internal_add_event(e):void re(W.WARNING,"add_business_event, you have to provide a valid event instead of: ["+e+"]")},this.add_technology_event=function(e){return e&&"object"==typeof e?void(e.key="tech_"+e.key,this.internal_add_event(e)):void re(W.WARNING,"add_technology_event, you have to provide a valid event instead of: ["+e+"]")},this.start_business_event=function(e){return e&&"string"==typeof e?void this.internal_start_event(e):void re(W.WARNING,"start_business_event, you have to provide a valid string key instead of: ["+e+"]")},this.start_technology_event=function(e){return e&&"string"==typeof e?void this.internal_start_event("tech_"+e):void re(W.WARNING,"start_technology_event, you have to provide a valid string key instead of: ["+e+"]")},this.cancel_business_event=function(e){return e&&"string"==typeof e?void this.internal_cancel_event(e):(re(W.WARNING,"cancel_business_event, you have to provide a valid string key instead of: ["+e+"]"),!1)},this.cancel_technology_event=function(e){return e&&"string"==typeof e?void this.internal_cancel_event("tech_"+e):(re(W.WARNING,"cancel_technology_event, you have to provide a valid string key instead of: ["+e+"]"),!1)},this.end_business_event=function(e){return e?void this.internal_end_event(e):void re(W.WARNING,"end_business_event, you have to provide a valid string key or event object instead of: ["+e+"]")},this.end_technology_event=function(e){return e?void("string"==typeof e?this.internal_end_event("tech_"+e):e.key="tech_"+e.key,this.internal_end_event(e)):void re(W.WARNING,"end_technology_event, you have to provide a valid string key or event object instead of: ["+e+"]")},this.internal_add_event=function(e){re(W.INFO,"add_event, Adding event: ",e);var t=!1;switch(e.key){case T.NPS:t=this.check_consent(C.FEEDBACK);break;case T.SURVEY:t=this.check_consent(C.FEEDBACK);break;case T.STAR_RATING:t=this.check_consent(C.STAR_RATING);break;case T.VIEW:t=this.check_consent(C.VIEWS);break;case T.ORIENTATION:t=this.check_consent(C.USERS);break;case T.ACTION:t=this.check_consent(C.CLICKS)||this.check_consent(C.SCROLLS);break;default:t=this.check_consent(C.EVENTS)}t&&d(e)},this.internal_start_event=function(e){return e&&"string"==typeof e?(re(W.INFO,"start_event, Starting timed event with key: ["+e+"]"),e=f(e,xe.maxKeyLength,"start_event",re),ze[e]?void re(W.WARNING,"start_event, Timed event with key: ["+e+"] already started"):void(ze[e]=c())):void re(W.WARNING,"start_event, you have to provide a valid string key instead of: ["+e+"]")},this.internal_cancel_event=function(e){return e&&"string"==typeof e?(re(W.INFO,"cancel_event, Canceling timed event with key: ["+e+"]"),e=f(e,xe.maxKeyLength,"cancel_event",re),ze[e])?(delete ze[e],re(W.INFO,"cancel_event, Timed event with key: ["+e+"] is canceled"),!0):(re(W.WARNING,"cancel_event, Timed event with key: ["+e+"] was not found"),!1):(re(W.WARNING,"cancel_event, you have to provide a valid string key instead of: ["+e+"]"),!1)},this.internal_end_event=function(e){return e?(re(W.INFO,"end_event, Ending timed event"),"string"==typeof e&&(e=f(e,xe.maxKeyLength,"end_event",re),e={key:e}),e.key?ze[e.key]?void(e.dur=c()-ze[e.key],this.internal_add_event(e),delete ze[e.key]):void re(W.ERROR,"end_event, Timed event with key: ["+e.key+"] was not started"):void re(W.ERROR,"end_event, Timed event must have a key property")):void re(W.WARNING,"end_event, you have to provide a valid string key or event object instead of: ["+e+"]")},this.report_orientation=function(e){re(W.INFO,"report_orientation, Reporting orientation"),this.check_consent(C.USERS)&&d({key:T.ORIENTATION,segmentation:{mode:e||w()}})},this.report_conversion=function(e,t){re(W.WARNING,"report_conversion, Deprecated function call! Use 'recordDirectAttribution' in place of this call. Call will be redirected now!"),this.recordDirectAttribution(e,t)},this.recordDirectAttribution=function(e,t){re(W.INFO,"recordDirectAttribution, Recording the attribution for campaign ID: ["+e+"] and the user ID: ["+t+"]"),this.check_consent(C.ATTRIBUTION)&&(e=e||fe("cly_cmp_id")||"cly_organic",t=t||fe("cly_cmp_uid"),t?Z({campaign_id:e,campaign_user:t}):Z({campaign_id:e}))},this.user_details=function(e){if(re(W.INFO,"user_details, Trying to add user details: ",e),this.check_consent(C.USERS)){P(),re(W.INFO,"user_details, flushed the event queue"),e.name=f(e.name,xe.maxValueSize,"user_details",re),e.username=f(e.username,xe.maxValueSize,"user_details",re),e.email=f(e.email,xe.maxValueSize,"user_details",re),e.organization=f(e.organization,xe.maxValueSize,"user_details",re),e.phone=f(e.phone,xe.maxValueSize,"user_details",re),e.picture=f(e.picture,4096,"user_details",re),e.gender=f(e.gender,xe.maxValueSize,"user_details",re),e.byear=f(e.byear,xe.maxValueSize,"user_details",re),e.custom=h(e.custom,xe.maxKeyLength,xe.maxValueSize,xe.maxSegmentationValues,"user_details",re);var t=["name","username","email","organization","phone","picture","gender","byear","custom"];Z({user_details:JSON.stringify(m(e,t))})}};var kt={},Rt=function(e,t,i){xe.check_consent(C.USERS)&&(!kt[e]&&(kt[e]={}),"$push"===i||"$pull"===i||"$addToSet"===i?(!kt[e][i]&&(kt[e][i]=[]),kt[e][i].push(t)):kt[e][i]=t)};this.userData={set:function(e,t){re(W.INFO,"set, Setting user's custom property value: ["+t+"] under the key: ["+e+"]"),e=f(e,xe.maxKeyLength,"userData set",re),t=f(t,xe.maxValueSize,"userData set",re),kt[e]=t},unset:function(e){re(W.INFO,"unset, Resetting user's custom property with key: ["+e+"] "),kt[e]=""},set_once:function(e,t){re(W.INFO,"set_once, Setting user's unique custom property value: ["+t+"] under the key: ["+e+"] "),e=f(e,xe.maxKeyLength,"userData set_once",re),t=f(t,xe.maxValueSize,"userData set_once",re),Rt(e,t,"$setOnce")},increment:function(e){re(W.INFO,"increment, Increasing user's custom property value under the key: ["+e+"] by one"),e=f(e,xe.maxKeyLength,"userData increment",re),Rt(e,1,"$inc")},increment_by:function(e,t){re(W.INFO,"increment_by, Increasing user's custom property value under the key: ["+e+"] by: ["+t+"]"),e=f(e,xe.maxKeyLength,"userData increment_by",re),t=f(t,xe.maxValueSize,"userData increment_by",re),Rt(e,t,"$inc")},multiply:function(e,t){re(W.INFO,"multiply, Multiplying user's custom property value under the key: ["+e+"] by: ["+t+"]"),e=f(e,xe.maxKeyLength,"userData multiply",re),t=f(t,xe.maxValueSize,"userData multiply",re),Rt(e,t,"$mul")},max:function(e,t){re(W.INFO,"max, Saving user's maximum custom property value compared to the value: ["+t+"] under the key: ["+e+"]"),e=f(e,xe.maxKeyLength,"userData max",re),t=f(t,xe.maxValueSize,"userData max",re),Rt(e,t,"$max")},min:function(e,t){re(W.INFO,"min, Saving user's minimum custom property value compared to the value: ["+t+"] under the key: ["+e+"]"),e=f(e,xe.maxKeyLength,"userData min",re),t=f(t,xe.maxValueSize,"userData min",re),Rt(e,t,"$min")},push:function(e,t){re(W.INFO,"push, Pushing a value: ["+t+"] under the key: ["+e+"] to user's custom property array"),e=f(e,xe.maxKeyLength,"userData push",re),t=f(t,xe.maxValueSize,"userData push",re),Rt(e,t,"$push")},push_unique:function(e,t){re(W.INFO,"push_unique, Pushing a unique value: ["+t+"] under the key: ["+e+"] to user's custom property array"),e=f(e,xe.maxKeyLength,"userData push_unique",re),t=f(t,xe.maxValueSize,"userData push_unique",re),Rt(e,t,"$addToSet")},pull:function(e,t){re(W.INFO,"pull, Removing the value: ["+t+"] under the key: ["+e+"] from user's custom property array"),Rt(e,t,"$pull")},save:function(){re(W.INFO,"save, Saving changes to user's custom property"),xe.check_consent(C.USERS)&&(P(),re(W.INFO,"user_details, flushed the event queue"),Z({user_details:JSON.stringify({custom:kt})})),kt={}}},this.report_trace=function(t){if(re(W.INFO,"report_trace, Reporting performance trace"),this.check_consent(C.APM)){for(var n=["type","name","stz","etz","apm_metrics","apm_attr"],a=0;a<n.length;a++)if("apm_attr"!==n[a]&&"undefined"==typeof t[n[a]])return void re(W.WARNING,"report_trace, APM trace don't have the property: "+n[a]);t.name=f(t.name,xe.maxKeyLength,"report_trace",re),t.app_metrics=h(t.app_metrics,xe.maxKeyLength,xe.maxValueSize,xe.maxSegmentationValues,"report_trace",re);var r=m(t,n);r.timestamp=t.stz;var e=new Date;r.hour=e.getHours(),r.dow=e.getDay(),Z({apm:JSON.stringify(r)}),re(W.INFO,"report_trace, Successfully adding APM trace: ",r)}},this.track_errors=function(e){re(W.INFO,"track_errors, Started tracking errors"),t.i[this.app_key].tracking_crashes=!0,window.cly_crashes||(window.cly_crashes=!0,Pe=e,window.onerror=function r(e,t,i,n,a){if(void 0!==a&&null!==a)_(a,!1);else{n=n||window.event&&window.event.errorCharacter;var o="";"undefined"!=typeof e&&(o+=e+"\n"),"undefined"!=typeof t&&(o+="at "+t),"undefined"!=typeof i&&(o+=":"+i),"undefined"!=typeof n&&(o+=":"+n),o+="\n";try{for(var s=[],d=r.caller;d;)s.push(d.name),d=d.caller;o+=s.join("\n")}catch(e){re(W.ERROR,"track_errors, Call stack generation experienced a problem: "+e)}_(o,!1)}},window.addEventListener("unhandledrejection",function(e){_(new Error("Unhandled rejection (reason: "+(e.reason&&e.reason.stack?e.reason.stack:e.reason)+")."),!0)}))},this.log_error=function(e,t){re(W.INFO,"log_error, Logging errors"),this.recordError(e,!0,t)},this.add_log=function(e){if(re(W.INFO,"add_log, Adding a new log of breadcrumbs: [ "+e+" ]"),this.check_consent(C.CRASHES)){for(e=f(e,xe.maxValueSize,"add_log",re);Fe.length>=xe.maxBreadcrumbCount;)Fe.shift(),re(W.WARNING,"add_log, Reached maximum crashLogs size. Will erase the oldest one.");Fe.push(e)}},this.fetch_remote_config=function(e,t,i){var n=null,a=null,r=null;if(e&&(i||"function"!=typeof e?Array.isArray(e)&&(n=e):r=e),t&&(i||"function"!=typeof t?Array.isArray(t)&&(a=t):r=t),r||"function"!=typeof i||(r=i),this.useExplicitRcApi){re(W.INFO,"fetch_remote_config, Fetching remote config");var o=this.rcAutoOptinAb?1:0;return void S(n,a,o,null,r)}re(W.WARNING,"fetch_remote_config, Fetching remote config, with legacy API"),S(n,a,null,"legacy",r)},this.enrollUserToAb=function(e){if(re(W.INFO,"enrollUserToAb, Providing AB test keys to opt in for"),!e||!Array.isArray(e)||0===e.length)return void re(W.ERROR,"enrollUserToAb, No keys provided");var t={method:"ab",keys:JSON.stringify(e)};J(t),oe("enrollUserToAb",this.url+Te,t,function(e,t,i){if(e)return void re(W.ERROR,"enrollUserToAb, An error occurred: "+e);try{var n=JSON.parse(i);re(W.DEBUG,"enrollUserToAb, Parsed the response's result: ["+n.result+"]")}catch(e){re(W.ERROR,"enrollUserToAb, Had an issue while parsing the response: "+e)}},!0)},this.get_remote_config=function(e){return re(W.INFO,"get_remote_config, Getting remote config from storage"),"undefined"==typeof e?Ge:Ge[e]},this.stop_time=function(){re(W.INFO,"stop_time, Stopping tracking duration"),dt&&(dt=!1,qe=c()-Oe,je=c()-He)},this.start_time=function(){re(W.INFO,"start_time, Starting tracking duration"),dt||(dt=!0,Oe=c()-qe,He=c()-je,je=0,$())},this.track_sessions=function(){function e(){document[i]||!document.hasFocus()?xe.stop_time():xe.start_time()}function t(){$e>=Qe&&xe.start_time(),$e=0}re(W.INFO,"track_session, Starting tracking user session"),this.begin_session(),this.start_time(),H(window,"beforeunload",function(){P(),xe.end_session()});var i="hidden";H(window,"focus",e),H(window,"blur",e),H(window,"pageshow",e),H(window,"pagehide",e),"onfocusin"in document&&(H(window,"focusin",e),H(window,"focusout",e)),i in document?document.addEventListener("visibilitychange",e):"mozHidden"in document?(i="mozHidden",document.addEventListener("mozvisibilitychange",e)):"webkitHidden"in document?(i="webkitHidden",document.addEventListener("webkitvisibilitychange",e)):"msHidden"in document&&(i="msHidden",document.addEventListener("msvisibilitychange",e)),H(window,"mousemove",t),H(window,"click",t),H(window,"keydown",t),H(window,"scroll",t),setInterval(function(){$e++,$e>=Qe&&xe.stop_time()},6e4)},this.track_pageview=function(e,t,n){if(re(W.INFO,"track_pageview, Tracking page views"),re(W.VERBOSE,"track_pageview, last view is:["+Ke+"], current view ID is:["+yt+"], previous view ID is:["+ht+"]"),Ke&&mt&&(re(W.DEBUG,"track_pageview, Scroll registry triggered"),le(),ut=!0,pt=0),X(),ht=yt,yt=o(),e=f(e,xe.maxKeyLength,"track_pageview",re),e&&Array.isArray(e)&&(t=e,e=null),e||(e=this.getViewName()),void 0===e||""===e)return void re(W.ERROR,"track_pageview, No page name to track (it is either undefined or empty string). No page view can be tracked.");if(null===e)return void re(W.ERROR,"track_pageview, View name returned as null. Page view will be ignored.");if(t&&t.length)for(var a=0;a<t.length;a++)try{var r=new RegExp(t[a]);if(r.test(e))return void re(W.INFO,"track_pageview, Ignoring the page: "+e)}catch(e){re(W.ERROR,"track_pageview, Problem with finding ignore list item: "+t[a]+", error: "+e)}Ke=e,He=c(),re(W.VERBOSE,"track_pageview, last view is assigned:["+Ke+"], current view ID is:["+yt+"], previous view ID is:["+ht+"]");var s={name:e,visit:1,view:xe.getViewUrl()};if(s=h(s,xe.maxKeyLength,xe.maxValueSize,xe.maxSegmentationValues,"track_pageview",re),this.track_domains&&(s.domain=window.location.hostname),tt){if(!De){var l=fe("cly_session");(!l||parseInt(l)<=c())&&(gt=!1,s.start=1)}else gt&&(gt=!1,s.start=1);}else if("undefined"!=typeof document.referrer&&document.referrer.length){var g=V.exec(document.referrer);g&&g[11]&&g[11]!==window.location.hostname&&(s.start=1)}if(n)for(var _ in n=h(n,xe.maxKeyLength,xe.maxValueSize,xe.maxSegmentationValues,"track_pageview",re),n)"undefined"==typeof s[_]&&(s[_]=n[_]);this.check_consent(C.VIEWS)?d({key:T.VIEW,segmentation:s},yt):st.track_pageview=arguments},this.track_view=function(e,t,i){re(W.INFO,"track_view, Initiating tracking page views"),this.track_pageview(e,t,i)},this.track_clicks=function(e){function t(e){if(i){if(i=!1,R(e),"undefined"!=typeof e.pageX&&"undefined"!=typeof e.pageY){var t=b(),n=I();if(xe.check_consent(C.CLICKS)){var a={type:"click",x:e.pageX,y:e.pageY,width:n,height:t,view:xe.getViewUrl()};a=h(a,xe.maxKeyLength,xe.maxValueSize,xe.maxSegmentationValues,"processClick",re),xe.track_domains&&(a.domain=window.location.hostname),d({key:T.ACTION,segmentation:a})}}setTimeout(function(){i=!0},1e3)}}re(W.INFO,"track_clicks, Starting to track clicks"),e&&re(W.INFO,"track_clicks, Tracking the specified children:["+e+"]"),e=e||document;var i=!0;H(e,"click",t)},this.track_scrolls=function(e){re(W.INFO,"track_scrolls, Starting to track scrolls"),e&&re(W.INFO,"track_scrolls, Tracking the specified children"),e=e||window,ut=!0,mt=!0,H(e,"scroll",ce),H(e,"beforeunload",le)},this.track_links=function(e){function t(e){var t=K(Y(e),"a");t&&(R(e),xe.check_consent(C.CLICKS)&&d({key:"linkClick",segmentation:{href:t.href,text:t.innerText,id:t.id,view:xe.getViewUrl()}}))}re(W.INFO,"track_links, Starting to track clicks to links"),e&&re(W.INFO,"track_links, Tracking the specified children"),e=e||document,H(e,"click",t)},this.track_forms=function(e,t){function n(e){return e.name||e.id||e.type||e.nodeName}function a(e){var a,o=Y(e),s={id:o.attributes.id&&o.attributes.id.nodeValue,name:o.attributes.name&&o.attributes.name.nodeValue,action:o.attributes.action&&o.attributes.action.nodeValue,method:o.attributes.method&&o.attributes.method.nodeValue,view:xe.getViewUrl()};if("undefined"!=typeof o.elements){for(var c=0;c<o.elements.length;c++)a=o.elements[c],a&&"password"!==a.type&&-1===a.className.indexOf("cly_user_ignore")&&("undefined"==typeof s["input:"+n(a)]&&(s["input:"+n(a)]=[]),"select"===a.nodeName.toLowerCase()?"undefined"==typeof a.multiple?s["input:"+n(a)].push(a.options[a.selectedIndex].value):s["input:"+n(a)].push(r(a)):"input"===a.nodeName.toLowerCase()?"undefined"==typeof a.type?s["input:"+n(a)].push(a.value):"checkbox"===a.type.toLowerCase()||"radio"===a.type.toLowerCase()?a.checked&&s["input:"+n(a)].push(a.value):("hidden"!==a.type.toLowerCase()||t)&&s["input:"+n(a)].push(a.value):"textarea"===a.nodeName.toLowerCase()?s["input:"+n(a)].push(a.value):"undefined"!=typeof a.value&&s["input:"+n(a)].push(a.value));for(var l in s)s[l]&&"function"==typeof s[l].join&&(s[l]=s[l].join(", "))}xe.check_consent(C.FORMS)&&d({key:"formSubmit",segmentation:s})}re(W.INFO,"track_forms, Starting to track form submissions. DOM object provided:["+!!e+"] Tracking hidden inputs :["+!!t+"]"),e=e||document,H(e,"submit",a)},this.collect_from_forms=function(e,t){function i(n){var a,o=Y(n),s={},d=!1;if("undefined"!=typeof o.elements){var c,l,g={},_=e.getElementsByTagName("LABEL");for(c=0;c<_.length;c++)_[c].htmlFor&&""!==_[c].htmlFor&&(g[_[c].htmlFor]=_[c].innerText||_[c].textContent||_[c].innerHTML);for(c=0;c<o.elements.length;c++)if(a=o.elements[c],a&&"password"!==a.type&&-1===a.className.indexOf("cly_user_ignore")){var u="";if("select"===a.nodeName.toLowerCase()?"undefined"==typeof a.multiple?u=a.options[a.selectedIndex].value:u=r(a):"input"===a.nodeName.toLowerCase()?"undefined"==typeof a.type?u=a.value:"checkbox"===a.type.toLowerCase()||"radio"===a.type.toLowerCase()?a.checked&&(u=a.value):u=a.value:"textarea"===a.nodeName.toLowerCase()?u=a.value:"undefined"!=typeof a.value&&(u=a.value),a.className&&-1!==a.className.indexOf("cly_user_")){var p=a.className.split(" ");for(l=0;l<p.length;l++)if(0===p[l].indexOf("cly_user_")){s[p[l].replace("cly_user_","")]=u,d=!0;break}}else a.type&&"email"===a.type.toLowerCase()||a.name&&-1!==a.name.toLowerCase().indexOf("email")||a.id&&-1!==a.id.toLowerCase().indexOf("email")||a.id&&g[a.id]&&-1!==g[a.id].toLowerCase().indexOf("email")||/[^@\s]+@[^@\s]+\.[^@\s]+/.test(u)?(s.email||(s.email=u),d=!0):a.name&&-1!==a.name.toLowerCase().indexOf("username")||a.id&&-1!==a.id.toLowerCase().indexOf("username")||a.id&&g[a.id]&&-1!==g[a.id].toLowerCase().indexOf("username")?(s.username||(s.username=u),d=!0):a.name&&(-1!==a.name.toLowerCase().indexOf("tel")||-1!==a.name.toLowerCase().indexOf("phone")||-1!==a.name.toLowerCase().indexOf("number"))||a.id&&(-1!==a.id.toLowerCase().indexOf("tel")||-1!==a.id.toLowerCase().indexOf("phone")||-1!==a.id.toLowerCase().indexOf("number"))||a.id&&g[a.id]&&(-1!==g[a.id].toLowerCase().indexOf("tel")||-1!==g[a.id].toLowerCase().indexOf("phone")||-1!==g[a.id].toLowerCase().indexOf("number"))?(s.phone||(s.phone=u),d=!0):a.name&&(-1!==a.name.toLowerCase().indexOf("org")||-1!==a.name.toLowerCase().indexOf("company"))||a.id&&(-1!==a.id.toLowerCase().indexOf("org")||-1!==a.id.toLowerCase().indexOf("company"))||a.id&&g[a.id]&&(-1!==g[a.id].toLowerCase().indexOf("org")||-1!==g[a.id].toLowerCase().indexOf("company"))?(s.organization||(s.organization=u),d=!0):(a.name&&-1!==a.name.toLowerCase().indexOf("name")||a.id&&-1!==a.id.toLowerCase().indexOf("name")||a.id&&g[a.id]&&-1!==g[a.id].toLowerCase().indexOf("name"))&&(s.name||(s.name=""),s.name+=u+" ",d=!0)}}d&&(re(W.INFO,"collect_from_forms, Gathered user data",s),t?xe.user_details({custom:s}):xe.user_details(s))}re(W.INFO,"collect_from_forms, Starting to collect possible user data. DOM object provided:["+!!e+"] Submitting custom user property:["+!!t+"]"),e=e||document,H(e,"submit",i)},this.collect_from_facebook=function(e){return"undefined"!=typeof FB&&FB&&FB.api?void(re(W.INFO,"collect_from_facebook, Starting to collect possible user data"),FB.api("/me",function(t){var n={};if(t.name&&(n.name=t.name),t.email&&(n.email=t.email),"male"===t.gender?n.gender="M":"female"===t.gender&&(n.gender="F"),t.birthday){var a=t.birthday.split("/").pop();a&&4===a.length&&(n.byear=a)}if(t.work&&t.work[0]&&t.work[0].employer&&t.work[0].employer.name&&(n.organization=t.work[0].employer.name),e)for(var r in n.custom={},e){for(var o=e[r].split("."),s=t,d=0;d<o.length&&(s=s[o[d]],"undefined"!=typeof s);d++);"undefined"!=typeof s&&(n.custom[r]=s)}xe.user_details(n)})):void re(W.ERROR,"collect_from_facebook, Facebook SDK is not available")},this.opt_out=function(){re(W.INFO,"opt_out, Opting out the user"),this.ignore_visitor=!0,Ee("cly_ignore",!0)},this.opt_in=function(){re(W.INFO,"opt_in, Opting in the user"),Ee("cly_ignore",!1),this.ignore_visitor=!1,G(),this.ignore_visitor||rt||ee()},this.report_feedback=function(e){re(W.WARNING,"report_feedback, Deprecated function call! Use 'recordRatingWidgetWithID' or 'reportFeedbackWidgetManually' in place of this call. Call will be redirected to 'recordRatingWidgetWithID' now!"),this.recordRatingWidgetWithID(e)},this.recordRatingWidgetWithID=function(e){if(re(W.INFO,"recordRatingWidgetWithID, Providing information about user with ID: [ "+e.widget_id+" ]"),!!this.check_consent(C.STAR_RATING)){if(!e.widget_id)return void re(W.ERROR,"recordRatingWidgetWithID, Rating Widget must contain widget_id property");if(!e.rating)return void re(W.ERROR,"recordRatingWidgetWithID, Rating Widget must contain rating property");var t=["widget_id","contactMe","platform","app_version","rating","email","comment"],i={key:T.STAR_RATING,count:1,segmentation:{}};i.segmentation=m(e,t),i.segmentation.app_version||(i.segmentation.app_version=this.metrics._app_version||this.app_version),5<i.segmentation.rating?(re(W.WARNING,"recordRatingWidgetWithID, You have entered a rating higher than 5. Changing it back to 5 now."),i.segmentation.rating=5):1>i.segmentation.rating&&(re(W.WARNING,"recordRatingWidgetWithID, You have entered a rating lower than 1. Changing it back to 1 now."),i.segmentation.rating=1),re(W.INFO,"recordRatingWidgetWithID, Reporting Rating Widget: ",i),d(i)}},this.reportFeedbackWidgetManually=function(e,t,i){if(this.check_consent(C.FEEDBACK)){if(!(e&&t))return void re(W.ERROR,"reportFeedbackWidgetManually, Widget data and/or Widget object not provided. Aborting.");if(!e._id)return void re(W.ERROR,"reportFeedbackWidgetManually, Feedback Widgets must contain _id property");if(ot)return void re(W.ERROR,"reportFeedbackWidgetManually, Feedback Widgets can not be reported in offline mode");re(W.INFO,"reportFeedbackWidgetManually, Providing information about user with, provided result of the widget with  ID: [ "+e._id+" ] and type: ["+e.type+"]");var n,r=[],o=e.type;if("nps"===o){if(i){if(!i.rating)return void re(W.ERROR,"reportFeedbackWidgetManually, Widget must contain rating property");i.rating=a(i.rating),10<i.rating?(re(W.WARNING,"reportFeedbackWidgetManually, You have entered a rating higher than 10. Changing it back to 10 now."),i.rating=10):0>i.rating&&(re(W.WARNING,"reportFeedbackWidgetManually, You have entered a rating lower than 0. Changing it back to 0 now."),i.rating=0),r=["rating","comment"]}n=T.NPS}else if("survey"===o){if(i){if(1>Object.keys(i).length)return void re(W.ERROR,"reportFeedbackWidgetManually, Widget should have answers to be reported");r=Object.keys(i)}n=T.SURVEY}else if("rating"===o){if(i){if(!i.rating)return void re(W.ERROR,"reportFeedbackWidgetManually, Widget must contain rating property");i.rating=a(i.rating),5<i.rating?(re(W.WARNING,"reportFeedbackWidgetManually, You have entered a rating higher than 5. Changing it back to 5 now."),i.rating=5):1>i.rating&&(re(W.WARNING,"reportFeedbackWidgetManually, You have entered a rating lower than 1. Changing it back to 1 now."),i.rating=1),r=["rating","comment","email","contactMe"]}n=T.STAR_RATING}else return void re(W.ERROR,"reportFeedbackWidgetManually, Widget has an unacceptable type");var s={key:n,count:1,segmentation:{widget_id:e._id,platform:this.platform,app_version:this.metrics._app_version||this.app_version}};null===i?s.segmentation.closed=1:s.segmentation=y(s.segmentation,i,r),re(W.INFO,"reportFeedbackWidgetManually, Reporting "+o+": ",s),d(s)}},this.show_feedback_popup=function(e){re(W.WARNING,"show_feedback_popup, Deprecated function call! Use 'presentRatingWidgetWithID' in place of this call. Call will be redirected now!"),this.presentRatingWidgetWithID(e)},this.presentRatingWidgetWithID=function(e){re(W.INFO,"presentRatingWidgetWithID, Showing rating widget popup for the widget with ID: [ "+e+" ]"),this.check_consent(C.STAR_RATING)&&(ot?re(W.ERROR,"presentRatingWidgetWithID, Cannot show ratingWidget popup in offline mode"):oe("presentRatingWidgetWithID",this.url+"/o/feedback/widget",{widget_id:e},function(e,t,i){if(e)return void re(W.ERROR,"presentRatingWidgetWithID, An error occurred: "+e);try{var n=JSON.parse(i);M(n,!1)}catch(e){re(W.ERROR,"presentRatingWidgetWithID, JSON parse failed: "+e)}},!0))},this.initialize_feedback_popups=function(e){re(W.WARNING,"initialize_feedback_popups, Deprecated function call! Use 'initializeRatingWidgets' in place of this call. Call will be redirected now!"),this.initializeRatingWidgets(e)},this.initializeRatingWidgets=function(e){if(re(W.INFO,"initializeRatingWidgets, Initializing rating widget with provided widget IDs:[ "+e+"]"),!!this.check_consent(C.STAR_RATING)){e||(e=fe("cly_fb_widgets"));for(var t=document.getElementsByClassName("countly-feedback-sticker");0<t.length;)t[0].remove();oe("initializeRatingWidgets",this.url+"/o/feedback/multiple-widgets-by-id",{widgets:JSON.stringify(e)},function(e,t,n){if(e)return void re(W.ERROR,"initializeRatingWidgets, An error occurred: "+e);try{for(var a=JSON.parse(n),r=0;r<a.length;r++)if("true"===a[r].is_active){var o=a[r].target_devices,s=v();if(o[s])if("string"==typeof a[r].hide_sticker&&(a[r].hide_sticker="true"===a[r].hide_sticker),"all"===a[r].target_page&&!a[r].hide_sticker)M(a[r],!0);else for(var d=a[r].target_pages,c=0;c<d.length;c++){var l=d[c].substr(0,d[c].length-1)===window.location.pathname.substr(0,d[c].length-1),g=d[c]===window.location.pathname,_=d[c].includes("*");(_&&l||g)&&!a[r].hide_sticker&&M(a[r],!0)}}}catch(e){re(W.ERROR,"initializeRatingWidgets, JSON parse error: "+e)}},!0)}},this.enable_feedback=function(e){re(W.WARNING,"enable_feedback, Deprecated function call! Use 'enableRatingWidgets' in place of this call. Call will be redirected now!"),this.enableRatingWidgets(e)},this.enableRatingWidgets=function(e){if(re(W.INFO,"enableRatingWidgets, Enabling rating widget with params:",e),!!this.check_consent(C.STAR_RATING))if(ot)re(W.ERROR,"enableRatingWidgets, Cannot enable rating widgets in offline mode");else{Ee("cly_fb_widgets",e.popups||e.widgets),x(this.url+"/star-rating/stylesheets/countly-feedback-web.css");var t=e.popups||e.widgets;0<t.length?(document.body.insertAdjacentHTML("beforeend","<div id=\"cfbg\"></div>"),this.initializeRatingWidgets(t)):re(W.ERROR,"enableRatingWidgets, You should provide at least one widget id as param. Read documentation for more detail. https://resources.count.ly/plugins/feedback")}},this.get_available_feedback_widgets=function(e){if(re(W.INFO,"get_available_feedback_widgets, Getting the feedback list, callback function is provided:["+!!e+"]"),!this.check_consent(C.FEEDBACK))return void(e&&e(null,new Error("Consent for feedback not provided.")));if(ot)return void re(W.ERROR,"get_available_feedback_widgets, Cannot enable feedback widgets in offline mode.");var t=this.url+Te,i={method:C.FEEDBACK,device_id:this.device_id,app_key:this.app_key};oe("get_available_feedback_widgets",t,i,function(t,i,n){if(t)return re(W.ERROR,"get_available_feedback_widgets, Error occurred while fetching feedbacks: "+t),void(e&&e(null,t));try{var a=JSON.parse(n),r=a.result||[];e&&e(r,null)}catch(t){re(W.ERROR,"get_available_feedback_widgets, Error while parsing feedback widgets list: "+t),e&&e(null,t)}},!1)},this.getFeedbackWidgetData=function(e,t){function i(e,i,n){if(e)return re(W.ERROR,"getFeedbackWidgetData, Error occurred while fetching feedbacks: "+e),void(t&&t(null,e));try{var a=JSON.parse(n);t&&t(a,null)}catch(e){re(W.ERROR,"getFeedbackWidgetData, Error while parsing feedback widgets list: "+e),t&&t(null,e)}}if(!e.type)return void re(W.ERROR,"getFeedbackWidgetData, Expected the provided widget object to have a type but got: ["+JSON.stringify(e)+"], aborting.");if(re(W.INFO,"getFeedbackWidgetData, Retrieving data for: ["+JSON.stringify(e)+"], callback function is provided:["+!!t+"]"),!this.check_consent(C.FEEDBACK))return void(t&&t(null,new Error("Consent for feedback not provided.")));if(ot)return void re(W.ERROR,"getFeedbackWidgetData, Cannot enable feedback widgets in offline mode.");var n=this.url,a={widget_id:e._id,shown:1,sdk_version:"23.6.0",sdk_name:z,platform:this.platform,app_version:this.app_version};if("nps"===e.type)n+="/o/surveys/nps/widget";else if("survey"===e.type)n+="/o/surveys/survey/widget";else if("rating"===e.type)n+="/o/surveys/rating/widget";else return void re(W.ERROR,"getFeedbackWidgetData, Unknown type info: ["+e.type+"]");oe("getFeedbackWidgetData",n,a,i,!0)},this.present_feedback_widget=function(t,n,e){function a(e){document.getElementById("countly-surveys-wrapper-"+e._id).style.display="block",document.getElementById("csbg").style.display="block"}function r(e){if(!e.appearance.hideS){re(W.DEBUG,"present_feedback_widget, handling the sticker as it was not set to hidden");var t=document.createElement("div");t.innerText=e.appearance.text,t.style.color=7>e.appearance.text_color.length?"#"+e.appearance.text_color:e.appearance.text_color,t.style.backgroundColor=7>e.appearance.bg_color.length?"#"+e.appearance.bg_color:e.appearance.bg_color,t.className="countly-feedback-sticker  "+e.appearance.position+"-"+e.appearance.size,t.id="countly-feedback-sticker-"+e._id,document.body.appendChild(t),H(document.getElementById("countly-feedback-sticker-"+e._id),"click",function(){document.getElementById("countly-ratings-wrapper-"+e._id).style.display="flex",document.getElementById("csbg").style.display="block"})}H(document.getElementById("countly-feedback-close-icon-"+e._id),"click",function(){document.getElementById("countly-ratings-wrapper-"+e._id).style.display="none",document.getElementById("csbg").style.display="none"})}if(re(W.INFO,"present_feedback_widget, Presenting the feedback widget by appending to the element with ID: [ "+n+" ] and className: [ "+e+" ]"),!!this.check_consent(C.FEEDBACK)){if(!t||"object"!=typeof t||Array.isArray(t))return void re(W.ERROR,"present_feedback_widget, Please provide at least one feedback widget object.");try{var o=this.url;if("nps"===t.type)re(W.DEBUG,"present_feedback_widget, Widget type: nps."),o+="/feedback/nps";else if("survey"===t.type)re(W.DEBUG,"present_feedback_widget, Widget type: survey."),o+="/feedback/survey";else if("rating"===t.type)re(W.DEBUG,"present_feedback_widget, Widget type: rating."),o+="/feedback/rating";else return void re(W.ERROR,"present_feedback_widget, Feedback widget only accepts nps, rating and survey types.");var s,d=window.origin||window.location.origin;"rating"===t.type?(re(W.DEBUG,"present_feedback_widget, Loading css for rating widget."),s="ratings",x(this.url+"/star-rating/stylesheets/countly-feedback-web.css")):(re(W.DEBUG,"present_feedback_widget, Loading css for survey or nps."),x(this.url+"/surveys/stylesheets/countly-surveys.css"),s="surveys"),o+="?widget_id="+t._id,o+="&app_key="+this.app_key,o+="&device_id="+this.device_id,o+="&sdk_name="+z,o+="&platform="+this.platform,o+="&app_version="+this.app_version,o+="&sdk_version=23.6.0",o+="&origin="+d,o+="&widget_v=web";var c=document.createElement("iframe");c.src=o,c.name="countly-"+s+"-iframe",c.id="countly-"+s+"-iframe";var l=!1;c.onload=function(){l&&(document.getElementById("countly-"+s+"-wrapper-"+t._id).style.display="none",document.getElementById("csbg").style.display="none"),l=!0,re(W.DEBUG,"present_feedback_widget, Loaded iframe.")};for(var g=document.getElementById("csbg");g;)g.remove(),g=document.getElementById("csbg"),re(W.DEBUG,"present_feedback_widget, Removing past overlay.");for(var _=document.getElementsByClassName("countly-"+s+"-wrapper"),u=0;u<_.length;u++)_[u].remove(),re(W.DEBUG,"present_feedback_widget, Removed a wrapper.");_=document.createElement("div"),_.className="countly-"+s+"-wrapper",_.id="countly-"+s+"-wrapper-"+t._id,"survey"===t.type&&(_.className=_.className+" "+t.appearance.position);var p=document.body,m=!1;if(n&&(document.getElementById(n)?(p=document.getElementById(n),m=!0):re(W.ERROR,"present_feedback_widget, Provided ID not found.")),!m&&e&&(document.getElementsByClassName(e)[0]?p=document.getElementsByClassName(e)[0]:re(W.ERROR,"present_feedback_widget, Provided class not found.")),p.insertAdjacentHTML("beforeend","<div id=\"csbg\"></div>"),p.appendChild(_),"rating"===t.type){var y=document.createElement("div");y.className="countly-ratings-overlay",y.id="countly-ratings-overlay-"+t._id,_.appendChild(y),re(W.DEBUG,"present_feedback_widget, appended the rating overlay to wrapper"),H(document.getElementById("countly-ratings-overlay-"+t._id),"click",function(){document.getElementById("countly-ratings-wrapper-"+t._id).style.display="none"})}if(_.appendChild(c),re(W.DEBUG,"present_feedback_widget, Appended the iframe"),H(window,"message",function(i){var e={};try{e=JSON.parse(i.data),re(W.DEBUG,"present_feedback_widget, Parsed response message "+e)}catch(e){re(W.ERROR,"present_feedback_widget, Error while parsing message body "+e)}return e.close?void(document.getElementById("countly-"+s+"-wrapper-"+t._id).style.display="none",document.getElementById("csbg").style.display="none"):void re(W.DEBUG,"present_feedback_widget, Closing signal not sent yet")}),"survey"===t.type){var h=!1;switch(t.showPolicy){case"afterPageLoad":"complete"===document.readyState?!h&&(h=!0,a(t)):H(document,"readystatechange",function(i){"complete"!==i.target.readyState||h||(h=!0,a(t))});break;case"afterConstantDelay":setTimeout(function(){h||(h=!0,a(t))},1e4);break;case"onAbandon":"complete"===document.readyState?H(document,"mouseleave",function(){h||(h=!0,a(t))}):H(document,"readystatechange",function(i){"complete"===i.target.readyState&&H(document,"mouseleave",function(){h||(h=!0,a(t))})});break;case"onScrollHalfwayDown":H(window,"scroll",function(){if(!h){var e=i(window.scrollY,document.body.scrollTop,document.documentElement.scrollTop),n=b();e>=n/2&&(h=!0,a(t))}});break;default:h||(h=!0,a(t))}}else if("nps"===t.type)document.getElementById("countly-"+s+"-wrapper-"+t._id).style.display="block",document.getElementById("csbg").style.display="block";else if("rating"===t.type){var f=!1;"complete"===document.readyState?!f&&(f=!0,r(t)):H(document,"readystatechange",function(i){"complete"!==i.target.readyState||f||(f=!0,r(t))})}}catch(t){re(W.ERROR,"present_feedback_widget, Something went wrong while presenting the widget: "+t)}}},this.recordError=function(e,t,a){if(re(W.INFO,"recordError, Recording error"),this.check_consent(C.CRASHES)&&e){a=a||Pe;var r="";if("object"==typeof e?"undefined"==typeof e.stack?("undefined"!=typeof e.name&&(r+=e.name+":"),"undefined"!=typeof e.message&&(r+=e.message+"\n"),"undefined"!=typeof e.fileName&&(r+="in "+e.fileName+"\n"),"undefined"!=typeof e.lineNumber&&(r+="on "+e.lineNumber),"undefined"!=typeof e.columnNumber&&(r+=":"+e.columnNumber)):r=e.stack:r=e+"",r.length>xe.maxStackTraceLineLength*xe.maxStackTraceLinesPerThread){re(W.DEBUG,"record_error, Error stack is too long will be truncated");var o=r.split("\n");o.length>xe.maxStackTraceLinesPerThread&&(o=o.splice(0,xe.maxStackTraceLinesPerThread));for(var s=0,d=o.length;s<d;s++)o[s].length>xe.maxStackTraceLineLength&&(o[s]=o[s].substring(0,xe.maxStackTraceLineLength));r=o.join("\n")}t=!!t;var l=ae(),g={_resolution:l._resolution,_error:r,_app_version:l._app_version,_run:c()-ct};g._not_os_specific=!0,g._javascript=!0;var _=navigator.battery||navigator.webkitBattery||navigator.mozBattery||navigator.msBattery;_&&(g._bat=n(100*_.level)),"undefined"!=typeof navigator.onLine&&(g._online=!!navigator.onLine),g._background=!document.hasFocus(),0<Fe.length&&(g._logs=Fe.join("\n")),Fe=[],g._nonfatal=t,g._view=this.getViewName(),"undefined"!=typeof a&&(a=h(a,xe.maxKeyLength,xe.maxValueSize,xe.maxSegmentationValues,"record_error",re),g._custom=a);try{var u=document.createElement("canvas"),p=u.getContext("experimental-webgl");g._opengl=p.getParameter(p.VERSION)}catch(e){re(W.ERROR,"Could not get the experimental-webgl context: "+e)}var m={};m.crash=JSON.stringify(g),m.metrics=JSON.stringify({_ua:l._ua}),Z(m)}},this.onStorageChange=function(e,t){switch(re(W.INFO,"onStorageChange, Applying storage changes"),e){case"cly_queue":Be=xe.deserialize(t||"[]");break;case"cly_event":Ue=xe.deserialize(t||"[]");break;case"cly_remote_configs":Ge=xe.deserialize(t||"{}");break;case"cly_ignore":xe.ignore_visitor=xe.deserialize(t);break;case"cly_id":xe.device_id=xe.deserialize(t);break;case"cly_id_type":_t=xe.deserialize(t);break;default:}},this._internals={store:Ee,getDocWidth:I,getDocHeight:b,getViewportHeight:N,get_page_coord:R,get_event_target:Y,add_event:H,createNewObjectFromProperties:m,truncateObject:h,truncateSingleValue:f,stripTrailingSlash:p,prepareParams:u,sendXmlHttpRequest:oe,isResponseValid:se,getInternalDeviceIdType:ge,getMsTimestamp:l,getTimestamp:c,isResponseValidBroad:de,secureRandom:o,log:re,getMetrics:ae,getUA:ne,prepareRequest:J,generateUUID:s,sendEventsForced:P,isUUID:ie,getId:te,heartBeat:ee,toRequestQueue:Z,reportViewDuration:X,loadJS:O,loadCSS:x,getLastView:Q,setToken:_e,getToken:ue,showLoader:A,hideLoader:D,setValueInStorage:Ee,getValueFromStorage:fe,removeValueFromStorage:ve,add_cly_events:d,processScrollView:le,processScroll:ce,currentUserAgentString:E,userAgentDeviceDetection:v,userAgentSearchBotDetection:k,getRequestQueue:me,getEventQueue:pe,clearQueue:function(){Be=[],Ee("cly_queue",[]),Ue=[],Ee("cly_event",[])}};var bt={};bt.sendInstantHCRequest=Se,bt.resetAndSaveCounters=we,bt.incrementErrorCount=Re,bt.incrementWarningCount=be,bt.resetCounters=Ie,bt.saveRequestCounters=Ne,this.initialize()};t.CountlyClass=M,t.init=function(e){if(e=e||{},t.loadAPMScriptsAsync&&P)return P=!1,void a(e);var i=e.app_key||t.app_key;if(!t.i||!t.i[i]){var n=new t.CountlyClass(e);if(!t.i)for(var r in t.i={},n)t[r]=n[r];t.i[i]=n}return t.i[i]};var q=0,K=function(e,t){for(t=t.toUpperCase();e;){if(e.nodeName.toUpperCase()===t)return e;e=e.parentElement}},H=function(e,t,i){"undefined"==typeof e.addEventListener?e.attachEvent("on"+t,i):e.addEventListener(t,i,!1)},Y=function(e){return e?"undefined"==typeof e.target?e.srcElement:e.target:window.event.srcElement};return window.addEventListener("storage",function(i){var e=(i.key+"").split("/"),n=e.pop(),a=e.pop();t.i&&t.i[a]&&t.i[a].onStorageChange(n,i.newValue)}),t.serialize=function(e){return"object"==typeof e&&(e=JSON.stringify(e)),e},t.deserialize=function(e){try{e=JSON.parse(e)}catch(t){}return e},t.getViewName=function(){return window.location.pathname},t.getViewUrl=function(){return window.location.pathname},t.getSearchQuery=function(){return window.location.search},t.DeviceIdType={DEVELOPER_SUPPLIED:B.DEVELOPER_SUPPLIED,SDK_GENERATED:B.SDK_GENERATED,TEMPORARY_ID:B.TEMPORARY_ID},t}});