## String
set key value：给指定的 key 设置 value
get key：获取指定 key 对应的 value
del key1 key2···：删除指定 key，可以同时删除多个
append key value：追加
strlen key：查看对应 key 的长度
incr key：为 key 存储的值自增 1，必须可以转成整型，否则报错。如果不存在 key，默认先设置该 key 值为 0，然后自增 1
decr key：为 key 存储的值自减 1，必须可以转成整型，否则报错。如果不存在 key，默认先设置该 key 值为 0，然后自减 1
incrby key number：为 key 存储的值自增 number，必须可以转成整型，否则报错，如果不存在的话，默认先将该值设置为 0，然后自增 number
decrby key number：为 key 存储的值自减 number，必须可以转成整型，否则报错，如果不存在的话，默认先将该值设置为 0，然后自减 number
getrange key start end：获取指定 value 的同时指定范围，第一个字符为 0，最后一个为 -1。注意：redis 中的索引都是包含结尾的，不管是这里的 getrange，还是后面的列表操作，索引都是包含两端的
setrange key start value：从索引为 start 的地方开始，将 key 对应的值替换为 value，替换的个数等于 value 的个数
mset key1 value1 key2 value2：同时设置多个 key value
mget key1 key2：同时返回多个 key 对应的 value
getset key value：先返回 key 的旧值，然后设置新值

string、list、hash、set、zset 都有自己的 key，key 不可以重名

keys pattern：查看所有名称满足 pattern 的 key，至于 key 对应的 value 则可以是 Redis 的任意类型
exists key：判断某个 key 是否存在
ttl key：查看还有多少秒过期，-1 表示永不过期，-2 表示已过期
expire key 秒钟：为给定的 key 设置过期时间
type key：查看你的 key 是什么类型
move key db：将 key 移动到指定的 db 中

连接redis

import redis

client = redis.Redis(host="10.84.2.41", decode_responses="utf-8", password="111111")

## Redis 列表 (List)

lpush key value1 value2 ...：将多个值设置到列表里面，从左边 push

rpush key value1 value2 ...：将多个值设置到列表里面，从右边 push

lrange key start end：遍历列表，索引从 0 开始，最后一个为 -1，且包含两端

lpop key：从列表的左端弹出一个值，列表长度改变

rpop key：从列表的右端弹出一个值，列表长度改变

lindex key index：获取指定索引位置的元素，列表长度不变

llen key：获取指定列表的长度

lrem key count value：删除 count 个 value，如果 count 为 0，那么将全部删除

ltrim key start end：从 start 截取到 end，再重新赋值给 key

rpoplpush key1 key2：移除 key1 的最后一个元素，并添加到 key2 的开头

lset key index value：将 key 中索引为 index 的元素设置为 value

linsert key before/after value1 value2：在 value1 的前面或者后面插入一个 value2

列表底层的数据类型是 quicklist（快速列表）

## Redis 字典 (Hash)

hset key field1 value1 field2 value2···：设置键值对，可同时设置多个。这里的键值对指的是 field、value，而命令中的 key 指的是字典、或者哈希表的名称

hget key field：获取 hash 中 field 对应的 value

hgetall key：获取 hash 中所有的键值对

hlen key：获取 hash 中键值对的个数

hexists key field：判断 hash 中是否存在指定的 field

hkeys/hvals key：获取 hash 中所有的 field 和所有的 value

hincrby key field number：将 hash 中字段 field 对应的值自增 number，number 必须指定，显然 field 对应的 value 要能解析成整型

hsetnx key field1 value1：每次只能设置一个键值对，不存在则设置，存在则无效。

hdel key field1 field2······：删除 hash 中的键，当然键没了，整个键值对就没了

字典类型本质上是由数组和链表结构组成的，来看字典类型的源码实现：

typedef struct dictEntry { // dict.h
    void *key;
    union {
        void *val;
        uint64_t u64;
        int64_t s64;
        double d;
    } v;
    struct dictEntry *next; // 下一个 entry
} dictEntry;

Redis 为了保证应用的高性能运行，提供了一个重要的机制——渐进式 rehash。 渐进式 rehash 是用来保证字典缩放效率的，也就是说在字典进行扩容或者缩容是会采取渐进式 rehash 的机制。


## Redis 集合 (Set)

Redis的集合和列表是类似的，都是用来存储多个标量，但是它和列表又有不同：

1. 列表中的元素是可以重复的，而集合中的元组不会重复。
2. 列表在插入元素的时候可以保持顺序，而集合不保证顺序（集合在存储数据时，底层也是使用了哈希表，后面会说）。

sadd key value1 value2···：向集合插入多个元素，如果重复会自动去重
smembers key：查看集合的所有元素
sismember key value：查看 value 是否在集合中
scard key：查看集合的元素个数
srem key value1 value2 ······：删除集合中的元素
spop key count：随机弹出集合中 count 个元素，注意：count 是可以省略的，如果省略则弹出 1 个。另外一旦弹出，原来的集合里面也就没有了
srandmember key count：随机获取集合中 count 个元素，注意：count 是可以省略的，如果省略则获取 1 个。可以看到类似 spop，但是 srandmember 不会删除集合中的元素。
smove key1 key2 value：将 key1 当中的 value 移动到 key2 当中，因此 key1 当中的元素会少一个，key2 会多一个（前提是 value 在 key2 中不重复，否则 key2 还和原来保持一致）。
sinter key1 key2：返回即在 key1 中，又在 key2 中的元素
sunion key1 key2：返回在 key1 中，或者在 key2 中的元素
sdiff key1 key2：返回在 key1 中，但不在 key2 中的元素

从上面代码可以看出，当所有元素都为整数时，集合会以 intset 结构进行数据存储。 当发生以下两种情况时，会导致集合类型使用 hashtable 而非 intset 存储：

1）当元素的个数超过一定数量时，默认是 512 个，该值可通过命令 set-max-intset-entries xxx 来配置
2）当元素为非整数时，集合将会使用 hashtable 来存储，如下代码所示：

## Redis 有序集合 (zset，Sorted Set)

edis的有序集合相比集合多了一个排序属性：score（分值），对于有序集合 zset 来说，每个存储元素相当于有两个值，一个是有序集合的元素值，一个是排序值（分值）。有序集合存储的元素值也是不重复的，但分数可以重复。

zadd key score1 value1 score2 value2：设置 score 和 value
zscore key value：获取 value 对应的 score
zrange key start end：获取指定范围的 value，递增排列，这里是基于索引获取
如果结尾加上 with scores 参数，那么会和 score 一同返回，注意：score 是在下面。我们看到这个 zset 有点像 hash 啊，value 是 hash 的 k，score 是 hash 的 v。

zrevrange key start end：获取所有的 value，递减排列，同理也有 withscores 参数

zrangebyscore key 开始score 结束score：获取 >=开始score  and <=结束score 的 value，递增排列，同理也有 withscores 参数

zrevrangebyscore key 结束score 开始score：获取 >=开始score and <=结束score 的value，递减排列，同理也有 withscores 参数。注意：这里的开始和结束是相反的。

